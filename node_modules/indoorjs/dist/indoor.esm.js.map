{"version":3,"file":"indoor.esm.js","sources":["../src/geometry/Point.js","../src/core/Constants.js","../node_modules/rollup-plugin-node-globals/src/global.js","../node_modules/process-es6/browser.js","../src/lib/ev-pos.js","../src/lib/impetus.js","../src/lib/mouse-event-offset.js","../src/lib/touch-pinch.js","../src/lib/raf.js","../src/lib/MagicScroll.js","../src/lib/panzoom.js","../src/lib/mumath/clamp.js","../src/lib/mumath/len.js","../src/lib/mumath/almost.js","../src/lib/mumath/range.js","../src/lib/mumath/log10.js","../src/lib/mumath/is-multiple.js","../src/lib/mumath/scale.js","../src/lib/mumath/parse-unit.js","../src/lib/mumath/to-px.js","../src/lib/mumath/is-plain-obj.js","../src/core/Base.js","../src/lib/color-alpha.js","../src/grid/gridStyle.js","../src/grid/Axis.js","../src/grid/Grid.js","../src/map/ModesMixin.js","../src/measurement/Measurer.js","../src/measurement/Measurement.js","../src/lib/mix.js","../src/map/Map.js","../src/layer/Group.js","../src/layer/Layer.js","../src/floorplan/Floor.js","../src/layer/vector/Line.js","../src/layer/Connector.js","../src/layer/marker/Marker.js","../src/layer/marker/Icon.js","../src/layer/vector/Polyline.js","../src/layer/vector/Circle.js","../src/layer/vector/Rect.js","../src/layer/marker/MarkerGroup.js","../src/paint/ArrowHead.js","../src/paint/Arrow.js","../src/paint/Canvas.js","../src/Indoor.js"],"sourcesContent":["export class Point extends fabric.Point {\n  constructor(...params) {\n    let x;\n    let y;\n    if (params.length > 1) {\n      [x, y] = params;\n    } else if (params.length === 0 || !params[0]) {\n      [x, y] = [0, 0];\n    } else if (Object.prototype.hasOwnProperty.call(params[0], 'x')) {\n      x = params[0].x;\n      y = params[0].y;\n    } else if (params[0].length) {\n      [[x, y]] = params;\n    } else {\n      console.error(\n        'Parameter for Point is not valid. Use Point(x,y) or Point({x,y}) or Point([x,y])',\n        params\n      );\n    }\n\n    super(x, y);\n  }\n\n  setX(x) {\n    this.x = x || 0;\n  }\n\n  setY(y) {\n    this.y = y || 0;\n  }\n\n  copy(point) {\n    this.x = point.x;\n    this.y = point.y;\n  }\n\n  getArray() {\n    return [this.x, this.y];\n  }\n}\n\nexport const point = (...params) => new Point(...params);\n","import { Point } from '../geometry/Point.js';\n\nexport const Modes = {\n  SELECT: 'SELECT',\n  GRAB: 'GRAB',\n  MEASURE: 'MEASURE',\n  DRAW: 'DRAW'\n};\n\nexport const MAP = {\n  center: new Point(),\n  zoom: 1,\n  minZoom: 0,\n  maxZoom: 20,\n  gridEnabled: true,\n  zoomEnabled: true,\n  selectEnabled: true,\n  mode: Modes.SELECT,\n  showGrid: true\n};\n\nexport const MARKER = {\n  position: new Point(),\n  minZoom: 1,\n  maxZoom: 20\n};\n\nexport const ICON = {\n  url:\n    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAy8SURBVHhe7Z1r1BVVGcdn5n0hQZMyL62VEGmIN4xqhaV2QQwE0cxLSHbRMsH6nvVdQEWgPpUo0kUDQQGt5eqLIaho2jKF1irAoEi8QEtdXApEV/2e2SPC4Zl59z5n5szl7P9af877cp7/s/d+nnln9uzZe0/QQPTDEfC8IAivCYLoh/x8J1zF7+v4fQvcAXfBAwnlZ/k/vhMbsQ0W8jvacLrxFfsU3x4Vw6kk6Wo+F8DVJG0bfDsMov/lSfFpfAePmbLCr5myPbqN95OIi/mcx+dzcJ+WsG5QyjZ1CObzOZnPY6WCHvnjKAI8lc9FfG7TklEFUrd/JXWUulJnj05xJryFgG7WAl5lUucXqfuspA0ebggn8M8KgviWFtw6kTbQyQxW0qaL4qZ5ZCG6jECt0QLZBNK2tbTxK0ljPd5DOAmu1oLWRNJW7iTijmzP42z4gBakXiBtfxCOkUD0GoZAOkjRf7TA9BKJwX+JxWw4VALTA5DOUPSCFoyiKAcafBn+hQo8AX8PH4LLEsrP8n98JzaxbVcPTspbT2wmUofGYjCcqzU+TxLILZTzMJxDQK8Ngj4Zxv0oPAaGcCCIjdiiEa34EF/iM9qilZknKWcelFg1CucQyGe0BndK89caPBAF0Qw+x8IiB2DEN2XEZS2XsrU6dUpi9Sz+PyEFNgDyMCXapTW0XeLvFRwv5lNuqT4QF1MOhlEHbl3juuR6MOBvN7H7uimmvpijNa5dEhBuFcPr8XuccV8pUCepW763s/i91bivF94H79ca5Er+EmQkbSn8gjiuCT4Pl1D3XEYy8SUd1do8WzgBrtUa4kr83Avlul5XyHX81xwI72jtcyF+HocnitMq4yM0tuNbPPyshp+LPTYDn4UdXxqILbeKwfDYYwUxkgpu1CpuS/Qv05u/MfHXQEjbOussot+Eo1OMv+pA/vI3aRW2JT4Wwg/H3pqNk+CdWgxsSaw34+Pk2FsFcDwVWq9V1IZo/03Pflriq4cgU8qinVpMbIh2A06kv1Uq6O2HT2oVtCF66dicFnvqTYyCbXeYib1MYC317qDtWz20MuTpZ9kGQR+8Q4uRDdEuj72UgLYHeejo/SDx4XEQ0U1arGyI+Dbjo2sIp2kVGYg0cn9vXu9tEfcLiJEevyyilfULXcGZVHK3VoksonmDSn458eGRivhx+etaDLOIZg9imWBTKAZR0HNaBbKI5k20MhjiYYdxEjMtlllE8zzaQh8lO3dWqNR+dH5GrDsuJHbOi17QzTfy/PElrcCBGS+h8mgL4dV6TLOJcLzR5wfu96O/aoVlkd7+9xO9R9uIZmqxzSKajQhzHR+YpRWURTSFnYp6EG1ceuNpbLlgtFzHtULSyKlLRqhkgMMjH0TE1GnEVXKG7nQj7wwPaQWkkYK53Qs+ZqQeOYKYut0eovmtkbaNcILmOItc969MxB65I7pCi3kWyWEnYy+upx1ZGu1RMO7SYp9GcvhUonNFdInmMI3Y70B0vNF6FIgPEevXtBykEftLE60Lwqc0Z+kMb0iEHoUj/I6eA53Y/zER2iL8ouYojdjLciuPriJ8XMtFGrF3Ghyy7vlzenkb+08bmUcX8UmJvZYTjdhb3xGMwvEBzYlG7JcYmUcJuE/LiUbJKfajjSwbt2gONOL0Lez9Hjjl4QxyYD1Ih70sQ8+EjPn/QxNrxF5WrHiUi6VabjSS239in/WMILpYE6YRgX/GXz7O1XKTRnI8JdGpWKSJNPqef5UQWs8sxnix0RyJYzg6XtFEOsPrEp1H6Qi/pefoSJLjVxHIBhitCCdqAo04kVE/vy1qdSDb51qPDmKr7lBm/cwZ218YiUeFsFjLlUZs1bkaf9aMNXIEyV64HpVCNEXLlUaMZfLoYfslycpeq/tJ7OT0r11DPMrF0eTG6jKAnYzfHLrCOLpKM9SI8Qqj8aggrDfd5AQg71g4iPmakcYoiGYmGo/KIbpRy5lGjH9iNAaPaUYag6C/KduXNRD9YzgIrLajwXit0cQrdKOXNKNWYidDibIBlEc1MZgcWQ3lY7cd+0EiGs4vVo8Vse10kqFH8bB6lC85x1Z2UA3O0ww0YpvbXHOPwmC9hgNb2c7Ofqk3trXfubL5CKdrudMotgiim7UvNQZBn3/6V3n0Wz8dJPc/FoXVjlUYy772I0XgUWmMkFxpOWwltrIzW7BK+7KVOJVe49Ei8Kg0hpIry7u6+D0J4Trty1biVF62YLPfvke5IEfRBi2HrcRUFo3YvQQBwydj9x51gNWUcck9ttEO7ctWYiivVPGoBx7RcthKcr8TW7uXOWAo1wuPemCllsNWSu6xtVsDgKGfAVwfWM0Ultxj6w+ABsLpAPCXgObB6RLgO4HNg1Mn0N8GNg+2t4FbsbXbBwBjPxBUD7gMBD0tAj8U3Cy4DgU7PQyKJxB4VBouD4Pugv5xcLPQP07LnUZyL4+D/YSQZiG8RsudRmxlQkjf+dqXGjEecIMBj9LhsMFHn0wJc5oUKq9l96g2bDv1ByeF+mnhzYFMC9+q5a6V2B2cFi5wWBgSnGMkHhVEWwtDBNZLwyhgRqLxqBzaXhrmF4c2BC6LQw97k4vL8vDXsPfLw6sHWR7+qpazVmLXujxcELlsEHFJIvKoDKLJWq40YvsCgiOe6/gtYuqNe7RcacRW2yImnKQZa+QI8ptEVQu5bBLltE0cB8y3E51H6Qi/qeVIoxwoCDhgdDicRkJ59btHJRCu0XKkEeOsy7d9R0KI4Fyj8ygR1k//hOQ4swN/FAZ+s+h6YYmWG43kdhv2Q4wsHQ4bDMT3k2cYmUcJOJ0cuGwXb7XBx2k4dXlhxG+MzKME3KvlRCM5lad/1i+SfFhzojFx/Ckj8+gixjr+of7OyKwQOr0p3N8RlAH7LeKF2F+YCG0RPq05SiP2302EHoUjvF7LQRqxfyYRuiCaqjlLI/YywOBfHFk8jpNYazlII/aXJVpX2O0e8i4R3G10HgVioRb7NMqZPNG1g/AizWkWOdquSMQeuSO6XIt5FslhJy+PjmF9RyCkkq+j8a+Pzx8yZ8P19fEuPf9UjKZg68EGIUedLCSNjNwjBxDL8Akt1mlEkusg3WytkCyimWekHjlgrhbjLKK51UjzgTwj+JtWUBbR+HcLdIxohhbbLKLZiDDrBZFtYbxW2EDk1HXYmyk8XBBdqcV0ICJ0HfSxxjytwCzSiP3oCqtQgzGe2O3TYppFdAuMvBgMolLWk0ffJZo30Y4zLjws8Bli9oYWyyyikcmeg42L4nAWBe3RKpBFaZCMKyQ+PFIRTiBWTrd7QjR7EY8xPgqH/RLkQ0kluRz4PkE6oqug82nfsPtL92/TKzIwaeRNiQ+Pg4hmarGyIeK5xkf3sVyrkA3R3gH7Yi+9DYnB7VqMbIj2wdhLSeBe0+2B0aFEvwaOij31Jj4OrVdmt5LYy3bvA87xKxoncPqy2pZMI9qdvdkviK/3Vpt0akQr2/adaHyVj5Op0GatorbEx8/hSbG3ZkOS9jMtBrYk1i/iY3jsrUI4hYpt0ipsS/TbORvckPhrIKRt0Xat7bZMkn+q8Vc9yH5D67WKuxA/f4BNWnQig2CPam11IbGV0/6I2GOFIac4q71qs0hj38HPr2Cd31Us2+n8krZYbcKVRfzII/baXCLlSdQyrSGuJHjyXFvWHlwgjmuC8+F91N1pHkUa8bUclt7bbwdtDxZpJKCPch29Dr8fNO4rBeokK6ajjk/1hxK/txv3tUV4LUHZrTWuXeJPtjhbxOelfA6LiykHx1KHqXxKXTrq3LUSf3vCIPyGKab+4DoePqs1tFMmB8My/H/PlFPoPobim+t6XNb9lG21v6Ir8fsn/I+VApsECZ7zfAJXEry/U45sgz6LRE1PNriWnrNsdW/zvgOxEVs0oo3308VXsEp8a2XmScqR5/lN3owznEggO75VdCHl7YUvwQ1UQJaxPQJXwqUJ5Wf5P74Tm9h2r+arKFIet3jhJOrQExgK59Boq33tm0xisI9YyAROiUnPQe6TV2iB6QXSdjnz1HmcIy9Ekzn9tf1UrG6krWto85Sk8R7vIbqc4HQ8ilhVStto41eTxnqkI17PJr1u6w0QqkraIBtocFcinV8PV5wFZxPEwm+/8qbU2dQ9OFsa4tEZhhBQGfW7h89CBl/yoNSNOi7mU9bj13Lsvg4YRoClA7WAz+dhLg9c2qGUbeoge+/HdSpzWLpnMYrr6zQ+fwqldy2DOFZvzXCh+DS+4zdtUFZcZi/PZ6wsZGWMvAzpApIkD6Ju5md5QaJ0xNbx+xa4A+6CBxLKz/J/W7GRiZYylIwm+pHxET+KHgkLX3XTXQTB/wEErHoK8OgOXgAAAABJRU5ErkJggg==',\n  size: [128, 128],\n  anchor: [64, 64]\n};\n\nfabric.Object.prototype.originX = 'center';\nfabric.Object.prototype.originY = 'center';\n\nfabric.Object.prototype.lockUniScaling = true;\nfabric.Object.prototype.lockScalingFlip = true;\nfabric.Object.prototype.transparentCorners = false;\nfabric.Object.prototype.centeredScaling = true;\n// fabric.Object.prototype.cornerStyle = 'circle';\nfabric.Object.prototype.cornerColor = 'blue';\nfabric.Object.prototype.borderColor = 'blue';\nfabric.Object.prototype.borderOpacity = 0.7;\nfabric.Object.prototype.cornerOpacity = 0.7;\nfabric.Object.prototype.cornerStrokeColor = 'blue';\n\nfabric.Object.prototype.borderColor = '#ff0099';\nfabric.Object.prototype.cornerColor = '#00eaff';\nfabric.Object.prototype.cornerStrokeColor = '#00bbff';\n\nfabric.Object.prototype.objectCaching = false;\nfabric.Group.prototype.objectCaching = true;\n\nfabric.Group.prototype.selectionBackgroundColor = 'rgba(45,207,171,0.25)';\n\nfabric.Object.prototype.borderDashArray = [3, 3];\n\nfabric.Object.prototype.padding = 5;\n\nfabric.Object.prototype.getBounds = function getBounds() {\n  const coords = [];\n  coords.push(new Point(this.left - this.width / 2.0, this.top - this.height / 2.0));\n  coords.push(new Point(this.left + this.width / 2.0, this.top + this.height / 2.0));\n  return coords;\n};\n","export default (typeof global !== \"undefined\" ? global :\n            typeof self !== \"undefined\" ? self :\n            typeof window !== \"undefined\" ? window : {});\n","// shim for using process in browser\n// based off https://github.com/defunctzombie/node-process/blob/master/browser.js\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\nvar cachedSetTimeout = defaultSetTimout;\nvar cachedClearTimeout = defaultClearTimeout;\nif (typeof global.setTimeout === 'function') {\n    cachedSetTimeout = setTimeout;\n}\nif (typeof global.clearTimeout === 'function') {\n    cachedClearTimeout = clearTimeout;\n}\n\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\nexport function nextTick(fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n}\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nexport var title = 'browser';\nexport var platform = 'browser';\nexport var browser = true;\nexport var env = {};\nexport var argv = [];\nexport var version = ''; // empty string to avoid regexp issues\nexport var versions = {};\nexport var release = {};\nexport var config = {};\n\nfunction noop() {}\n\nexport var on = noop;\nexport var addListener = noop;\nexport var once = noop;\nexport var off = noop;\nexport var removeListener = noop;\nexport var removeAllListeners = noop;\nexport var emit = noop;\n\nexport function binding(name) {\n    throw new Error('process.binding is not supported');\n}\n\nexport function cwd () { return '/' }\nexport function chdir (dir) {\n    throw new Error('process.chdir is not supported');\n};\nexport function umask() { return 0; }\n\n// from https://github.com/kumavis/browser-process-hrtime/blob/master/index.js\nvar performance = global.performance || {}\nvar performanceNow =\n  performance.now        ||\n  performance.mozNow     ||\n  performance.msNow      ||\n  performance.oNow       ||\n  performance.webkitNow  ||\n  function(){ return (new Date()).getTime() }\n\n// generate timestamp or delta\n// see http://nodejs.org/api/process.html#process_process_hrtime\nexport function hrtime(previousTimestamp){\n  var clocktime = performanceNow.call(performance)*1e-3\n  var seconds = Math.floor(clocktime)\n  var nanoseconds = Math.floor((clocktime%1)*1e9)\n  if (previousTimestamp) {\n    seconds = seconds - previousTimestamp[0]\n    nanoseconds = nanoseconds - previousTimestamp[1]\n    if (nanoseconds<0) {\n      seconds--\n      nanoseconds += 1e9\n    }\n  }\n  return [seconds,nanoseconds]\n}\n\nvar startTime = new Date();\nexport function uptime() {\n  var currentTime = new Date();\n  var dif = currentTime - startTime;\n  return dif / 1000;\n}\n\nexport default {\n  nextTick: nextTick,\n  title: title,\n  browser: browser,\n  env: env,\n  argv: argv,\n  version: version,\n  versions: versions,\n  on: on,\n  addListener: addListener,\n  once: once,\n  off: off,\n  removeListener: removeListener,\n  removeAllListeners: removeAllListeners,\n  emit: emit,\n  binding: binding,\n  cwd: cwd,\n  chdir: chdir,\n  umask: umask,\n  hrtime: hrtime,\n  platform: platform,\n  release: release,\n  config: config,\n  uptime: uptime\n};\n","const isNum = function (val) {\n  return typeof val === 'number' && !isNaN(val);\n};\n\nexport default (ev, toElement) => {\n  toElement = toElement || ev.currentTarget;\n\n  const toElementBoundingRect = toElement.getBoundingClientRect();\n  const orgEv = ev.originalEvent || ev;\n  const hasTouches = ev.touches && ev.touches.length;\n  let pageX = 0;\n  let pageY = 0;\n\n  if (hasTouches) {\n    if (isNum(ev.touches[0].pageX) && isNum(ev.touches[0].pageY)) {\n      pageX = ev.touches[0].pageX;\n      pageY = ev.touches[0].pageY;\n    } else if (isNum(ev.touches[0].clientX) && isNum(ev.touches[0].clientY)) {\n      pageX = orgEv.touches[0].clientX;\n      pageY = orgEv.touches[0].clientY;\n    }\n  } else if (isNum(ev.pageX) && isNum(ev.pageY)) {\n    pageX = ev.pageX;\n    pageY = ev.pageY;\n  } else if (ev.currentPoint && isNum(ev.currentPoint.x) && isNum(ev.currentPoint.y)) {\n    pageX = ev.currentPoint.x;\n    pageY = ev.currentPoint.y;\n  }\n  let isRight = false;\n  if ('which' in ev) {\n    // Gecko (Firefox), WebKit (Safari/Chrome) & Opera\n    isRight = ev.which == 3;\n  } else if ('button' in ev) {\n    // IE, Opera\n    isRight = ev.button == 2;\n  }\n\n  return {\n    x: pageX - toElementBoundingRect.left,\n    y: pageY - toElementBoundingRect.top,\n    isRight\n  };\n};\n","const stopThresholdDefault = 0.3;\nconst bounceDeceleration = 0.04;\nconst bounceAcceleration = 0.11;\n\n// fixes weird safari 10 bug where preventDefault is prevented\n// @see https://github.com/metafizzy/flickity/issues/457#issuecomment-254501356\nwindow.addEventListener('touchmove', () => {});\n\nexport default class Impetus {\n  constructor({\n    source: sourceEl = document,\n    update: updateCallback,\n    stop: stopCallback,\n    multiplier = 1,\n    friction = 0.92,\n    initialValues,\n    boundX,\n    boundY,\n    bounce = true\n  }) {\n    let boundXmin;\n    let boundXmax;\n    let boundYmin;\n    let boundYmax;\n    let pointerLastX;\n    let pointerLastY;\n    let pointerCurrentX;\n    let pointerCurrentY;\n    let pointerId;\n    let decVelX;\n    let decVelY;\n    let targetX = 0;\n    let targetY = 0;\n    let stopThreshold = stopThresholdDefault * multiplier;\n    let ticking = false;\n    let pointerActive = false;\n    let paused = false;\n    let decelerating = false;\n    let trackingPoints = [];\n\n    /**\n     * Initialize instance\n     */\n    (function init() {\n      sourceEl = typeof sourceEl === 'string' ? document.querySelector(sourceEl) : sourceEl;\n      if (!sourceEl) {\n        throw new Error('IMPETUS: source not found.');\n      }\n\n      if (!updateCallback) {\n        throw new Error('IMPETUS: update function not defined.');\n      }\n\n      if (initialValues) {\n        if (initialValues[0]) {\n          targetX = initialValues[0];\n        }\n        if (initialValues[1]) {\n          targetY = initialValues[1];\n        }\n        callUpdateCallback();\n      }\n\n      // Initialize bound values\n      if (boundX) {\n        boundXmin = boundX[0];\n        boundXmax = boundX[1];\n      }\n      if (boundY) {\n        boundYmin = boundY[0];\n        boundYmax = boundY[1];\n      }\n\n      sourceEl.addEventListener('touchstart', onDown);\n      sourceEl.addEventListener('mousedown', onDown);\n    }());\n\n    /**\n     * In edge cases where you may need to\n     * reinstanciate Impetus on the same sourceEl\n     * this will remove the previous event listeners\n     */\n    this.destroy = function () {\n      sourceEl.removeEventListener('touchstart', onDown);\n      sourceEl.removeEventListener('mousedown', onDown);\n\n      cleanUpRuntimeEvents();\n\n      // however it won't \"destroy\" a reference\n      // to instance if you'd like to do that\n      // it returns null as a convinience.\n      // ex: `instance = instance.destroy();`\n      return null;\n    };\n\n    /**\n     * Disable movement processing\n     * @public\n     */\n    this.pause = function () {\n      cleanUpRuntimeEvents();\n\n      pointerActive = false;\n      paused = true;\n    };\n\n    /**\n     * Enable movement processing\n     * @public\n     */\n    this.resume = function () {\n      paused = false;\n    };\n\n    /**\n     * Update the current x and y values\n     * @public\n     * @param {Number} x\n     * @param {Number} y\n     */\n    this.setValues = function (x, y) {\n      if (typeof x === 'number') {\n        targetX = x;\n      }\n      if (typeof y === 'number') {\n        targetY = y;\n      }\n    };\n\n    /**\n     * Update the multiplier value\n     * @public\n     * @param {Number} val\n     */\n    this.setMultiplier = function (val) {\n      multiplier = val;\n      stopThreshold = stopThresholdDefault * multiplier;\n    };\n\n    /**\n     * Update boundX value\n     * @public\n     * @param {Number[]} boundX\n     */\n    this.setBoundX = function (boundX) {\n      boundXmin = boundX[0];\n      boundXmax = boundX[1];\n    };\n\n    /**\n     * Update boundY value\n     * @public\n     * @param {Number[]} boundY\n     */\n    this.setBoundY = function (boundY) {\n      boundYmin = boundY[0];\n      boundYmax = boundY[1];\n    };\n\n    /**\n     * Removes all events set by this instance during runtime\n     */\n    function cleanUpRuntimeEvents() {\n      // Remove all touch events added during 'onDown' as well.\n      document.removeEventListener(\n        'touchmove',\n        onMove,\n        getPassiveSupported() ? { passive: false } : false\n      );\n      document.removeEventListener('touchend', onUp);\n      document.removeEventListener('touchcancel', stopTracking);\n      document.removeEventListener(\n        'mousemove',\n        onMove,\n        getPassiveSupported() ? { passive: false } : false\n      );\n      document.removeEventListener('mouseup', onUp);\n    }\n\n    /**\n     * Add all required runtime events\n     */\n    function addRuntimeEvents() {\n      cleanUpRuntimeEvents();\n\n      // @see https://developers.google.com/web/updates/2017/01/scrolling-intervention\n      document.addEventListener(\n        'touchmove',\n        onMove,\n        getPassiveSupported() ? { passive: false } : false\n      );\n      document.addEventListener('touchend', onUp);\n      document.addEventListener('touchcancel', stopTracking);\n      document.addEventListener(\n        'mousemove',\n        onMove,\n        getPassiveSupported() ? { passive: false } : false\n      );\n      document.addEventListener('mouseup', onUp);\n    }\n\n    /**\n     * Executes the update function\n     */\n    function callUpdateCallback() {\n      updateCallback.call(sourceEl, targetX, targetY);\n    }\n\n    /**\n     * Creates a custom normalized event object from touch and mouse events\n     * @param  {Event} ev\n     * @returns {Object} with x, y, and id properties\n     */\n    function normalizeEvent(ev) {\n      if (ev.type === 'touchmove' || ev.type === 'touchstart' || ev.type === 'touchend') {\n        const touch = ev.targetTouches[0] || ev.changedTouches[0];\n        return {\n          x: touch.clientX,\n          y: touch.clientY,\n          id: touch.identifier\n        };\n      }\n      // mouse events\n      return {\n        x: ev.clientX,\n        y: ev.clientY,\n        id: null\n      };\n    }\n\n    /**\n     * Initializes movement tracking\n     * @param  {Object} ev Normalized event\n     */\n    function onDown(ev) {\n      const event = normalizeEvent(ev);\n      if (!pointerActive && !paused) {\n        pointerActive = true;\n        decelerating = false;\n        pointerId = event.id;\n\n        pointerLastX = pointerCurrentX = event.x;\n        pointerLastY = pointerCurrentY = event.y;\n        trackingPoints = [];\n        addTrackingPoint(pointerLastX, pointerLastY);\n\n        addRuntimeEvents();\n      }\n    }\n\n    /**\n     * Handles move events\n     * @param  {Object} ev Normalized event\n     */\n    function onMove(ev) {\n      ev.preventDefault();\n      const event = normalizeEvent(ev);\n\n      if (pointerActive && event.id === pointerId) {\n        pointerCurrentX = event.x;\n        pointerCurrentY = event.y;\n        addTrackingPoint(pointerLastX, pointerLastY);\n        requestTick();\n      }\n    }\n\n    /**\n     * Handles up/end events\n     * @param {Object} ev Normalized event\n     */\n    function onUp(ev) {\n      const event = normalizeEvent(ev);\n\n      if (pointerActive && event.id === pointerId) {\n        stopTracking();\n      }\n    }\n\n    /**\n     * Stops movement tracking, starts animation\n     */\n    function stopTracking() {\n      pointerActive = false;\n      addTrackingPoint(pointerLastX, pointerLastY);\n      startDecelAnim();\n\n      cleanUpRuntimeEvents();\n    }\n\n    /**\n     * Records movement for the last 100ms\n     * @param {number} x\n     * @param {number} y [description]\n     */\n    function addTrackingPoint(x, y) {\n      const time = Date.now();\n      while (trackingPoints.length > 0) {\n        if (time - trackingPoints[0].time <= 100) {\n          break;\n        }\n        trackingPoints.shift();\n      }\n\n      trackingPoints.push({ x, y, time });\n    }\n\n    /**\n     * Calculate new values, call update function\n     */\n    function updateAndRender() {\n      const pointerChangeX = pointerCurrentX - pointerLastX;\n      const pointerChangeY = pointerCurrentY - pointerLastY;\n\n      targetX += pointerChangeX * multiplier;\n      targetY += pointerChangeY * multiplier;\n\n      if (bounce) {\n        const diff = checkBounds();\n        if (diff.x !== 0) {\n          targetX -= pointerChangeX * dragOutOfBoundsMultiplier(diff.x) * multiplier;\n        }\n        if (diff.y !== 0) {\n          targetY -= pointerChangeY * dragOutOfBoundsMultiplier(diff.y) * multiplier;\n        }\n      } else {\n        checkBounds(true);\n      }\n\n      callUpdateCallback();\n\n      pointerLastX = pointerCurrentX;\n      pointerLastY = pointerCurrentY;\n      ticking = false;\n    }\n\n    /**\n     * Returns a value from around 0.5 to 1, based on distance\n     * @param {Number} val\n     */\n    function dragOutOfBoundsMultiplier(val) {\n      return 0.000005 * Math.pow(val, 2) + 0.0001 * val + 0.55;\n    }\n\n    /**\n     * prevents animating faster than current framerate\n     */\n    function requestTick() {\n      if (!ticking) {\n        requestAnimFrame(updateAndRender);\n      }\n      ticking = true;\n    }\n\n    /**\n     * Determine position relative to bounds\n     * @param {Boolean} restrict Whether to restrict target to bounds\n     */\n    function checkBounds(restrict) {\n      let xDiff = 0;\n      let yDiff = 0;\n\n      if (boundXmin !== undefined && targetX < boundXmin) {\n        xDiff = boundXmin - targetX;\n      } else if (boundXmax !== undefined && targetX > boundXmax) {\n        xDiff = boundXmax - targetX;\n      }\n\n      if (boundYmin !== undefined && targetY < boundYmin) {\n        yDiff = boundYmin - targetY;\n      } else if (boundYmax !== undefined && targetY > boundYmax) {\n        yDiff = boundYmax - targetY;\n      }\n\n      if (restrict) {\n        if (xDiff !== 0) {\n          targetX = xDiff > 0 ? boundXmin : boundXmax;\n        }\n        if (yDiff !== 0) {\n          targetY = yDiff > 0 ? boundYmin : boundYmax;\n        }\n      }\n\n      return {\n        x: xDiff,\n        y: yDiff,\n        inBounds: xDiff === 0 && yDiff === 0\n      };\n    }\n\n    /**\n     * Initialize animation of values coming to a stop\n     */\n    function startDecelAnim() {\n      const firstPoint = trackingPoints[0];\n      const lastPoint = trackingPoints[trackingPoints.length - 1];\n\n      const xOffset = lastPoint.x - firstPoint.x;\n      const yOffset = lastPoint.y - firstPoint.y;\n      const timeOffset = lastPoint.time - firstPoint.time;\n\n      const D = timeOffset / 15 / multiplier;\n\n      decVelX = xOffset / D || 0; // prevent NaN\n      decVelY = yOffset / D || 0;\n\n      const diff = checkBounds();\n\n      if (Math.abs(decVelX) > 1 || Math.abs(decVelY) > 1 || !diff.inBounds) {\n        decelerating = true;\n        requestAnimFrame(stepDecelAnim);\n      } else if (stopCallback) {\n        stopCallback(sourceEl);\n      }\n    }\n\n    /**\n     * Animates values slowing down\n     */\n    function stepDecelAnim() {\n      if (!decelerating) {\n        return;\n      }\n\n      decVelX *= friction;\n      decVelY *= friction;\n\n      targetX += decVelX;\n      targetY += decVelY;\n\n      const diff = checkBounds();\n\n      if (\n        Math.abs(decVelX) > stopThreshold\n        || Math.abs(decVelY) > stopThreshold\n        || !diff.inBounds\n      ) {\n        if (bounce) {\n          const reboundAdjust = 2.5;\n\n          if (diff.x !== 0) {\n            if (diff.x * decVelX <= 0) {\n              decVelX += diff.x * bounceDeceleration;\n            } else {\n              const adjust = diff.x > 0 ? reboundAdjust : -reboundAdjust;\n              decVelX = (diff.x + adjust) * bounceAcceleration;\n            }\n          }\n          if (diff.y !== 0) {\n            if (diff.y * decVelY <= 0) {\n              decVelY += diff.y * bounceDeceleration;\n            } else {\n              const adjust = diff.y > 0 ? reboundAdjust : -reboundAdjust;\n              decVelY = (diff.y + adjust) * bounceAcceleration;\n            }\n          }\n        } else {\n          if (diff.x !== 0) {\n            if (diff.x > 0) {\n              targetX = boundXmin;\n            } else {\n              targetX = boundXmax;\n            }\n            decVelX = 0;\n          }\n          if (diff.y !== 0) {\n            if (diff.y > 0) {\n              targetY = boundYmin;\n            } else {\n              targetY = boundYmax;\n            }\n            decVelY = 0;\n          }\n        }\n\n        callUpdateCallback();\n\n        requestAnimFrame(stepDecelAnim);\n      } else {\n        decelerating = false;\n        if (stopCallback) {\n          stopCallback(sourceEl);\n        }\n      }\n    }\n  }\n}\n\n/**\n * @see http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/\n */\nconst requestAnimFrame = (function () {\n  return (\n    window.requestAnimationFrame\n    || window.webkitRequestAnimationFrame\n    || window.mozRequestAnimationFrame\n    || function (callback) {\n      window.setTimeout(callback, 1000 / 60);\n    }\n  );\n}());\n\nfunction getPassiveSupported() {\n  let passiveSupported = false;\n\n  try {\n    const options = Object.defineProperty({}, 'passive', {\n      get() {\n        passiveSupported = true;\n      }\n    });\n\n    window.addEventListener('test', null, options);\n  } catch (err) {}\n\n  getPassiveSupported = () => passiveSupported;\n  return passiveSupported;\n}\n","var rootPosition = { left: 0, top: 0 }\n\nexport default mouseEventOffset\nfunction mouseEventOffset (ev, target, out) {\n  target = target || ev.currentTarget || ev.srcElement\n  if (!Array.isArray(out)) {\n    out = [ 0, 0 ]\n  }\n  var cx = ev.clientX || 0\n  var cy = ev.clientY || 0\n  var rect = getBoundingClientOffset(target)\n  out[0] = cx - rect.left\n  out[1] = cy - rect.top\n  return out\n}\n\nfunction getBoundingClientOffset (element) {\n  if (element === window ||\n      element === document ||\n      element === document.body) {\n    return rootPosition\n  } else {\n    return element.getBoundingClientRect()\n  }\n}\n","import EventEmitter2 from 'eventemitter2';\nimport eventOffset from './mouse-event-offset';\n\nfunction distance(a, b) {\n  var x = b[0] - a[0],\n      y = b[1] - a[1]\n  return Math.sqrt(x*x + y*y)\n}\n\nexport default touchPinch;\nfunction touchPinch (target) {\n  target = target || window\n\n  var emitter = new EventEmitter2()\n  var fingers = [ null, null ]\n  var activeCount = 0\n\n  var lastDistance = 0\n  var ended = false\n  var enabled = false\n\n  // some read-only values\n  Object.defineProperties(emitter, {\n    pinching(){\n      return activeCount === 2\n    },\n\n    fingers() {\n      return fingers\n    }\n  })\n\n  enable()\n  emitter.enable = enable\n  emitter.disable = disable\n  emitter.indexOfTouch = indexOfTouch\n  return emitter\n\n  function indexOfTouch (touch) {\n    var id = touch.identifier\n    for (var i = 0; i < fingers.length; i++) {\n      if (fingers[i] &&\n        fingers[i].touch &&\n        fingers[i].touch.identifier === id) {\n        return i\n      }\n    }\n    return -1\n  }\n\n  function enable () {\n    if (enabled) return\n    enabled = true\n    target.addEventListener('touchstart', onTouchStart, false)\n    target.addEventListener('touchmove', onTouchMove, false)\n    target.addEventListener('touchend', onTouchRemoved, false)\n    target.addEventListener('touchcancel', onTouchRemoved, false)\n  }\n\n  function disable () {\n    if (!enabled) return\n    enabled = false\n    activeCount = 0\n    fingers[0] = null\n    fingers[1] = null\n    lastDistance = 0\n    ended = false\n    target.removeEventListener('touchstart', onTouchStart, false)\n    target.removeEventListener('touchmove', onTouchMove, false)\n    target.removeEventListener('touchend', onTouchRemoved, false)\n    target.removeEventListener('touchcancel', onTouchRemoved, false)\n  }\n\n  function onTouchStart (ev) {\n    for (var i = 0; i < ev.changedTouches.length; i++) {\n      var newTouch = ev.changedTouches[i]\n      var id = newTouch.identifier\n      var idx = indexOfTouch(id)\n\n      if (idx === -1 && activeCount < 2) {\n        var first = activeCount === 0\n\n        // newest and previous finger (previous may be undefined)\n        var newIndex = fingers[0] ? 1 : 0\n        var oldIndex = fingers[0] ? 0 : 1\n        var newFinger = new Finger()\n\n        // add to stack\n        fingers[newIndex] = newFinger\n        activeCount++\n\n        // update touch event & position\n        newFinger.touch = newTouch\n        eventOffset(newTouch, target, newFinger.position)\n\n        var oldTouch = fingers[oldIndex] ? fingers[oldIndex].touch : undefined\n        emitter.emit('place', newTouch, oldTouch)\n\n        if (!first) {\n          var initialDistance = computeDistance()\n          ended = false\n          emitter.emit('start', initialDistance)\n          lastDistance = initialDistance\n        }\n      }\n    }\n  }\n\n  function onTouchMove (ev) {\n    var changed = false\n    for (var i = 0; i < ev.changedTouches.length; i++) {\n      var movedTouch = ev.changedTouches[i]\n      var idx = indexOfTouch(movedTouch)\n      if (idx !== -1) {\n        changed = true\n        fingers[idx].touch = movedTouch // avoid caching touches\n        eventOffset(movedTouch, target, fingers[idx].position)\n      }\n    }\n\n    if (activeCount === 2 && changed) {\n      var currentDistance = computeDistance()\n      emitter.emit('change', currentDistance, lastDistance)\n      lastDistance = currentDistance\n    }\n  }\n\n  function onTouchRemoved (ev) {\n    for (var i = 0; i < ev.changedTouches.length; i++) {\n      var removed = ev.changedTouches[i]\n      var idx = indexOfTouch(removed)\n\n      if (idx !== -1) {\n        fingers[idx] = null\n        activeCount--\n        var otherIdx = idx === 0 ? 1 : 0\n        var otherTouch = fingers[otherIdx] ? fingers[otherIdx].touch : undefined\n        emitter.emit('lift', removed, otherTouch)\n      }\n    }\n\n    if (!ended && activeCount !== 2) {\n      ended = true\n      emitter.emit('end')\n    }\n  }\n\n  function computeDistance () {\n    if (activeCount < 2) return 0\n    return distance(fingers[0].position, fingers[1].position)\n  }\n}\n\nfunction Finger () {\n  this.position = [0, 0]\n  this.touch = null\n}\n","function getPrefixed(name) {\n\treturn window['webkit' + name] || window['moz' + name] || window['ms' + name];\n}\n\nvar lastTime = 0;\n\n// fallback for IE 7-8\nfunction timeoutDefer(fn) {\n\tvar time = +new Date(),\n\t    timeToCall = Math.max(0, 16 - (time - lastTime));\n\n\tlastTime = time + timeToCall;\n\treturn window.setTimeout(fn, timeToCall);\n}\n\nexport function bind(fn, obj) {\n\tvar slice = Array.prototype.slice;\n\n\tif (fn.bind) {\n\t\treturn fn.bind.apply(fn, slice.call(arguments, 1));\n\t}\n\n\tvar args = slice.call(arguments, 2);\n\n\treturn function () {\n\t\treturn fn.apply(obj, args.length ? args.concat(slice.call(arguments)) : arguments);\n\t};\n}\n\nexport var requestFn = window.requestAnimationFrame || getPrefixed('RequestAnimationFrame') || timeoutDefer;\nexport var cancelFn = window.cancelAnimationFrame || getPrefixed('CancelAnimationFrame') ||\n\t\tgetPrefixed('CancelRequestAnimationFrame') || function (id) { window.clearTimeout(id); };\n\nconst raf = (fn, context, immediate) =>{\n\tif (immediate && requestFn === timeoutDefer) {\n\t\tfn.call(context);\n\t} else {\n\t\treturn requestFn.call(window, bind(fn, context));\n\t}\n} \n\nraf.cancel = (id) => {\n\tif (id) {\n\t\tcancelFn.call(window, id);\n\t}\n}\n\nexport default raf;","class MagicScroll {\n  constructor(target, speed = 80, smooth = 12, current = 0, passive = false) {\n    if (target === document) {\n      target = document.scrollingElement\n        || document.documentElement\n        || document.body.parentNode\n        || document.body;\n    } // cross browser support for document scrolling\n\n    this.speed = speed;\n    this.smooth = smooth;\n    this.moving = false;\n    this.scrollTop = current * 3000;\n    this.pos = this.scrollTop;\n    this.frame = target === document.body && document.documentElement ? document.documentElement : target; // safari is the new IE\n\n    target.addEventListener('wheel', scrolled, { passive });\n    target.addEventListener('DOMMouseScroll', scrolled, { passive });\n    const scope = this;\n    function scrolled(e) {\n      e.preventDefault(); // disable default scrolling\n\n      const delta = scope.normalizeWheelDelta(e);\n\n      scope.pos += -delta * scope.speed;\n      // scope.pos = Math.max(0, Math.min(scope.pos, 3000)); // limit scrolling\n\n      if (!scope.moving) scope.update(e);\n    }\n  }\n\n  normalizeWheelDelta(e) {\n    if (e.detail) {\n      if (e.wheelDelta) return (e.wheelDelta / e.detail / 40) * (e.detail > 0 ? 1 : -1);\n      // Opera\n      return -e.detail / 3; // Firefox\n    }\n    return e.wheelDelta / 120; // IE,Safari,Chrome\n  }\n\n  update(e) {\n    this.moving = true;\n\n    const delta = (this.pos - this.scrollTop) / this.smooth;\n\n    this.scrollTop += delta;\n\n    // this.scrollTop = Math.round(this.scrollTop);\n\n    if (this.onUpdate) {\n      this.onUpdate(delta, e);\n    }\n    const scope = this;\n    if (Math.abs(delta) > 1) {\n      requestFrame(() => {\n        scope.update();\n      });\n    } else this.moving = false;\n  }\n}\n\nexport default MagicScroll;\n\nvar requestFrame = (function () {\n  // requestAnimationFrame cross browser\n  return (\n    window.requestAnimationFrame\n    || window.webkitRequestAnimationFrame\n    || window.mozRequestAnimationFrame\n    || window.oRequestAnimationFrame\n    || window.msRequestAnimationFrame\n    || function (func) {\n      window.setTimeout(func, 1000);\n    }\n  );\n}());\n","import evPos from './ev-pos';\nimport Impetus from './impetus';\nimport touchPinch from './touch-pinch';\nimport raf from './raf';\nimport MagicScroll from './MagicScroll';\n\nconst panzoom = (target, cb) => {\n  if (target instanceof Function) {\n    cb = target;\n    target = document.documentElement || document.body;\n  }\n\n  if (typeof target === 'string') target = document.querySelector(target);\n\n  let cursor = {\n    x: 0,\n    y: 0\n  };\n\n  const hasPassive = () => {\n    let supported = false;\n\n    try {\n      const opts = Object.defineProperty({}, 'passive', {\n        get() {\n          supported = true;\n        }\n      });\n\n      window.addEventListener('test', null, opts);\n      window.removeEventListener('test', null, opts);\n    } catch (e) {\n      supported = false;\n    }\n\n    return supported;\n  };\n\n  let impetus;\n  let magicScroll;\n\n  let initX = 0;\n  let initY = 0;\n  let init = true;\n  const initFn = function(e) {\n    init = true;\n  };\n  target.addEventListener('mousedown', initFn);\n\n  const onMouseMove = e => {\n    cursor = evPos(e);\n  };\n\n  target.addEventListener('mousemove', onMouseMove);\n\n  const wheelListener = function(e) {\n    if (e) {\n      cursor = evPos(e);\n    }\n  };\n\n  target.addEventListener('wheel', wheelListener);\n  target.addEventListener('touchstart', initFn, hasPassive() ? { passive: true } : false);\n\n  target.addEventListener(\n    'contextmenu',\n    e => {\n      e.preventDefault();\n      return false;\n    },\n    false\n  );\n\n  let lastY = 0;\n  let lastX = 0;\n  impetus = new Impetus({\n    source: target,\n    update(x, y) {\n      if (init) {\n        init = false;\n        initX = cursor.x;\n        initY = cursor.y;\n      }\n\n      const e = {\n        target,\n        type: 'mouse',\n        dx: x - lastX,\n        dy: y - lastY,\n        dz: 0,\n        x: cursor.x,\n        y: cursor.y,\n        x0: initX,\n        y0: initY,\n        isRight: cursor.isRight\n      };\n\n      lastX = x;\n      lastY = y;\n\n      schedule(e);\n    },\n    stop() {\n      const ev = {\n        target,\n        type: 'mouse',\n        dx: 0,\n        dy: 0,\n        dz: 0,\n        x: cursor.x,\n        y: cursor.y,\n        x0: initX,\n        y0: initY\n      };\n      schedule(ev);\n    },\n    multiplier: 1,\n    friction: 0.75\n  });\n\n  magicScroll = new MagicScroll(target, 80, 12, 0);\n\n  magicScroll.onUpdate = (dy, e) => {\n    schedule({\n      target,\n      type: 'mouse',\n      dx: 0,\n      dy: 0,\n      dz: dy,\n      x: cursor.x,\n      y: cursor.y,\n      x0: cursor.x,\n      y0: cursor.y\n    });\n  };\n\n  // mobile pinch zoom\n  const pinch = touchPinch(target);\n  const mult = 2;\n  let initialCoords;\n\n  pinch.on('start', curr => {\n    const f1 = pinch.fingers[0];\n    const f2 = pinch.fingers[1];\n\n    initialCoords = [\n      f2.position[0] * 0.5 + f1.position[0] * 0.5,\n      f2.position[1] * 0.5 + f1.position[1] * 0.5\n    ];\n\n    impetus && impetus.pause();\n  });\n  pinch.on('end', () => {\n    if (!initialCoords) return;\n\n    initialCoords = null;\n\n    impetus && impetus.resume();\n  });\n  pinch.on('change', (curr, prev) => {\n    if (!pinch.pinching || !initialCoords) return;\n\n    schedule({\n      target,\n      type: 'touch',\n      dx: 0,\n      dy: 0,\n      dz: -(curr - prev) * mult,\n      x: initialCoords[0],\n      y: initialCoords[1],\n      x0: initialCoords[0],\n      y0: initialCoords[0]\n    });\n  });\n\n  // schedule function to current or next frame\n  let planned;\n  let frameId;\n  function schedule(ev) {\n    if (frameId != null) {\n      if (!planned) planned = ev;\n      else {\n        planned.dx += ev.dx;\n        planned.dy += ev.dy;\n        planned.dz += ev.dz;\n\n        planned.x = ev.x;\n        planned.y = ev.y;\n      }\n\n      return;\n    }\n\n    // Firefox sometimes does not clear webgl current drawing buffer\n    // so we have to schedule callback to the next frame, not the current\n    // cb(ev)\n\n    frameId = raf(() => {\n      cb(ev);\n      frameId = null;\n      if (planned) {\n        const arg = planned;\n        planned = null;\n        schedule(arg);\n      }\n    });\n  }\n\n  return function unpanzoom() {\n    target.removeEventListener('mousedown', initFn);\n    target.removeEventListener('mousemove', onMouseMove);\n    target.removeEventListener('touchstart', initFn);\n\n    impetus.destroy();\n\n    target.removeEventListener('wheel', wheelListener);\n\n    pinch.disable();\n\n    raf.cancel(frameId);\n  };\n};\n\nexport default panzoom;\n","/**\n * Clamp value.\n * Detects proper clamp min/max.\n *\n * @param {number} a Current value to cut off\n * @param {number} min One side limit\n * @param {number} max Other side limit\n *\n * @return {number} Clamped value\n */\n\nfunction clamp(a, min, max) {\n\treturn max > min ? Math.max(Math.min(a,max),min) : Math.max(Math.min(a,min),max);\n};\n\nexport default clamp;\n","/**\n * Return quadratic length\n *\n * @module  mumath/len\n *\n */\n\nexport default function len(a, b) {\n\treturn Math.sqrt(a*a + b*b);\n};\n","\n// Type definitions for almost-equal 1.1\n// Project: https://github.com/mikolalysenko/almost-equal#readme\n// Definitions by: Curtis Maddalozzo <https://github.com/cmaddalozzo>\n// Definitions: https://github.com/DefinitelyTyped/DefinitelyTyped\n\nvar abs = Math.abs;\nvar min = Math.min;\n\nfunction almostEqual(a, b, absoluteError, relativeError) {\n  var d = abs(a - b)\n  \n  if (absoluteError == null) absoluteError = almostEqual.DBL_EPSILON;\n  if (relativeError == null) relativeError = absoluteError;\n  \n  if(d <= absoluteError) {\n    return true\n  }\n  if(d <= relativeError * min(abs(a), abs(b))) {\n    return true\n  }\n  return a === b\n}\n\nexport const FLT_EPSILON = 1.19209290e-7\nexport const DBL_EPSILON = 2.2204460492503131e-16\n\nalmostEqual.FLT_EPSILON = FLT_EPSILON;\nalmostEqual.DBL_EPSILON = DBL_EPSILON;\n\nexport default almostEqual;","// The MIT License (MIT)\n\n// Copyright (c) 2016 angus croll\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\n  range(0, 5); // [0, 1, 2, 3, 4]\n  range(5); // [0, 1, 2, 3, 4]\n  range(-5); // [0, -1, -2, -3, -4]\n  range(0, 20, 5) // [0, 5, 10, 15]\n  range(0, -20, -5) // [0, -5, -10, -15]\n*/\n\nexport default function range(start, stop, step) {\n  if (start != null && typeof start != 'number') {\n    throw new Error('start must be a number or null');\n  }\n  if (stop != null && typeof stop != 'number') {\n    throw new Error('stop must be a number or null');\n  }\n  if (step != null && typeof step != 'number') {\n    throw new Error('step must be a number or null');\n  }\n  if (stop == null) {\n    stop = start || 0;\n    start = 0;\n  }\n  if (step == null) {\n    step = stop > start ? 1 : -1;\n  }\n  var toReturn = [];\n  var increasing = start < stop; //← here’s the change\n  for (; increasing ? start < stop : start > stop; start += step) {\n    toReturn.push(start);\n  }\n  return toReturn;\n}","/**\n * Base 10 logarithm\n *\n * @module mumath/log10\n */\n'use strict';\nexport default Math.log10 || function (a) {\n\treturn Math.log(a) / Math.log(10);\n};\n","/**\n * Check if one number is multiple of other\n *\n * @module  mumath/is-multiple\n */\n\nimport almost from './almost';\n\nexport default function isMultiple(a, b, eps) {\n\tvar remainder = a % b;\n\n\tif (!eps) eps = almost.FLT_EPSILON;\n\n\tif (!remainder) return true;\n\tif (almost(0, remainder, eps, 0) || almost(Math.abs(b), Math.abs(remainder), eps, 0)) return true;\n\n\treturn false;\n}\n","/**\n * Get step out of the set\n *\n * @module mumath/step\n */\n'use strict';\n\nimport lg from './log10';\n\nexport default function (minStep, srcSteps) {\n\tvar power = Math.floor(lg(minStep));\n\n\tvar order = Math.pow(10, power);\n\tvar steps = srcSteps.map(v => v*order);\n\torder = Math.pow(10, power+1);\n\tsteps = steps.concat(srcSteps.map(v => v*order));\n\n\t//find closest scale\n\tvar step = 0;\n\tfor (var i = 0; i < steps.length; i++) {\n\t\tstep = steps[i];\n\t\tif (step >= minStep) break;\n\t}\n\n\treturn step;\n};\n","export default (str, out) => {\n  if (!out)\n      out = [ 0, '' ]\n\n  str = String(str)\n  var num = parseFloat(str, 10)\n  out[0] = num\n  out[1] = str.match(/[\\d.\\-\\+]*\\s*(.*)/)[1] || ''\n  return out\n}","// (c) 2015 Mikola Lysenko. MIT License\n// https://github.com/mikolalysenko/to-px\n\nimport parseUnit from './parse-unit';\n\nvar PIXELS_PER_INCH = 96\n\nvar defaults = {\n  'ch': 8,\n  'ex': 7.15625,\n  'em': 16,\n  'rem': 16,\n  'in': PIXELS_PER_INCH,\n  'cm': PIXELS_PER_INCH / 2.54,\n  'mm': PIXELS_PER_INCH / 25.4,\n  'pt': PIXELS_PER_INCH / 72,\n  'pc': PIXELS_PER_INCH / 6,\n  'px': 1\n}\n\nexport default function toPX(str) {\n  if (!str) return null\n\n  if (defaults[str]) return defaults[str]\n\n  // detect number of units\n  var parts = parseUnit(str)\n  if (!isNaN(parts[0]) && parts[1]) {\n    var px = toPX(parts[1])\n    return typeof px === 'number' ? parts[0] * px : null;\n  }\n\n  return null;\n}","/**\n * MIT © Sindre Sorhus\n * https://github.com/sindresorhus/is-plain-obj/blob/master/index.js\n */\nexport default (value) => {\n\tif (Object.prototype.toString.call(value) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tconst prototype = Object.getPrototypeOf(value);\n\treturn prototype === null || prototype === Object.getPrototypeOf({});\n};\n","import EventEmitter2 from 'eventemitter2';\n\nclass Base extends EventEmitter2 {\n  constructor(options) {\n    super(options);\n    this._options = options || {};\n    Object.assign(this, options);\n  }\n}\n\nexport default Base;\n","export default alpha;\n\nfunction alpha (color, value) {\n\tlet obj = color.replace(/[^\\d,]/g, '').split(',');\n  if (value == null) value = obj[3] || 1;\n  obj[3] = value;\n\treturn 'rgba('+obj.join(',')+')';\n}\n","/* eslint-disable consistent-return */\nimport alpha from '../lib/color-alpha';\nimport {\n  range, almost, scale, isMultiple, lg\n} from '../lib/mumath/index';\n\nconst gridStyle = {\n  steps: [1, 2, 5],\n  distance: 20,\n  unit: 10,\n  lines: (state) => {\n    const coord = state.coordinate;\n    // eslint-disable-next-line no-multi-assign\n    const step = state.step = scale(coord.distance * coord.zoom, coord.steps);\n    return range(Math.floor(state.offset / step) * step,\n      Math.ceil((state.offset + state.range) / step + 1) * step, step);\n  },\n  lineColor: (state) => {\n    if (!state.lines) return;\n    const coord = state.coordinate;\n\n    const light = alpha(coord.color, 0.1);\n    const heavy = alpha(coord.color, 0.3);\n\n    const step = state.step;\n    const power = Math.ceil(lg(step));\n    const tenStep = 10 ** power;\n    const nextStep = 10 ** (power + 1);\n    const eps = step / 10;\n    const colors = state.lines.map(v => {\n      if (isMultiple(v, nextStep, eps)) return heavy;\n      if (isMultiple(v, tenStep, eps)) return light;\n      return null;\n    });\n    return colors;\n  },\n  ticks: state => {\n    if (!state.lines) return;\n    const coord = state.coordinate;\n    const step = scale(scale(state.step * 1.1, coord.steps) * 1.1, coord.steps);\n    const eps = step / 10;\n    const tickWidth = state.axisWidth * 4;\n    return state.lines.map(v => {\n      if (!isMultiple(v, step, eps)) return null;\n      if (almost(v, 0, eps)) return null;\n      return tickWidth;\n    });\n  },\n  labels: state => {\n    if (!state.lines) return;\n    const coord = state.coordinate;\n\n    const step = scale(scale(state.step * 1.1, coord.steps) * 1.1, coord.steps);\n    // let precision = clamp(Math.abs(Math.floor(lg(step))), 10, 20);\n    const eps = step / 100;\n    return state.lines.map(v => {\n      if (!isMultiple(v, step, eps)) return null;\n      if (almost(v, 0, eps)) return coord.orientation === 'y' ? null : '0';\n      v = Number((v / 100).toFixed(2));\n      return coord.format(v);\n    });\n  }\n};\n\nexport default gridStyle;\n","class Axis {\n  constructor(orientation, options) {\n    Object.assign(this, options);\n    this.orientation = orientation || 'x';\n  }\n\n  getCoords(values) {\n    const coords = [];\n    if (!values) return coords;\n    for (let i = 0; i < values.length; i += 1) {\n      const t = this.getRatio(values[i]);\n      coords.push(t);\n      coords.push(0);\n      coords.push(t);\n      coords.push(1);\n    }\n    return coords;\n  }\n\n  getRange() {\n    let len = this.width;\n    if (this.orientation === 'y') len = this.height;\n    return len * this.zoom;\n  }\n\n  getRatio(value) {\n    return (value - this.offset) / this.range;\n  }\n\n  setOffset(offset) {\n    this.offset = offset;\n  }\n\n  update(options) {\n    options = options || {};\n    Object.assign(this, options);\n\n    this.range = this.getRange();\n  }\n}\nexport default Axis;\n","import alpha from '../lib/color-alpha';\nimport Base from '../core/Base';\nimport { clamp, almost, len, parseUnit, toPx, isObj } from '../lib/mumath/index';\nimport gridStyle from './gridStyle';\nimport Axis from './Axis';\nimport { Point } from '../geometry/Point';\n\n// constructor\nclass Grid extends Base {\n  constructor(canvas, opts) {\n    super(opts);\n    this.canvas = canvas;\n    this.context = this.canvas.getContext('2d');\n    this.state = {};\n    this.setDefaults();\n    this.update(opts);\n    console.log(this.padding);\n  }\n\n  render() {\n    this.draw();\n    return this;\n  }\n\n  getCenterCoords() {\n    let state = this.state.x;\n    let [width, height] = state.shape;\n    let [pt, pr, pb, pl] = state.padding;\n    let axisCoords = state.opposite.coordinate.getCoords(\n      [state.coordinate.axisOrigin],\n      state.opposite\n    );\n    const y = pt + axisCoords[1] * (height - pt - pb);\n    state = this.state.y;\n    [width, height] = state.shape;\n    [pt, pr, pb, pl] = state.padding;\n    axisCoords = state.opposite.coordinate.getCoords([state.coordinate.axisOrigin], state.opposite);\n    const x = pl + axisCoords[0] * (width - pr - pl);\n    return { x, y };\n  }\n\n  setSize(width, height) {\n    this.setWidth(width);\n    this.setHeight(height);\n  }\n\n  setWidth(width) {\n    this.canvas.width = width;\n  }\n\n  setHeight(height) {\n    this.canvas.height = height;\n  }\n\n  // re-evaluate lines, calc options for renderer\n  update(opts) {\n    if (!opts) opts = {};\n    const shape = [this.canvas.width, this.canvas.height];\n\n    // recalc state\n    this.state.x = this.calcCoordinate(this.axisX, shape, this);\n    this.state.y = this.calcCoordinate(this.axisY, shape, this);\n    this.state.x.opposite = this.state.y;\n    this.state.y.opposite = this.state.x;\n    this.emit('update', opts);\n    return this;\n  }\n\n  // re-evaluate lines, calc options for renderer\n  update2(center) {\n    const shape = [this.canvas.width, this.canvas.height];\n    Object.assign(this.center, center);\n    // recalc state\n    this.state.x = this.calcCoordinate(this.axisX, shape, this);\n    this.state.y = this.calcCoordinate(this.axisY, shape, this);\n    this.state.x.opposite = this.state.y;\n    this.state.y.opposite = this.state.x;\n    this.emit('update', center);\n\n    this.axisX.offset = center.x;\n    this.axisX.zoom = 1 / center.zoom;\n\n    this.axisY.offset = center.y;\n    this.axisY.zoom = 1 / center.zoom;\n  }\n\n  // get state object with calculated params, ready for rendering\n  calcCoordinate(coord, shape) {\n    const state = {\n      coordinate: coord,\n      shape,\n      grid: this\n    };\n    // calculate real offset/range\n    state.range = coord.getRange(state);\n    state.offset = clamp(\n      coord.offset - state.range * clamp(0.5, 0, 1),\n      Math.max(coord.min, -Number.MAX_VALUE + 1),\n      Math.min(coord.max, Number.MAX_VALUE) - state.range\n    );\n\n    state.zoom = coord.zoom;\n    // calc style\n    state.axisColor =\n      typeof coord.axisColor === 'number'\n        ? alpha(coord.color, coord.axisColor)\n        : coord.axisColor || coord.color;\n\n    state.axisWidth = coord.axisWidth || coord.lineWidth;\n    state.lineWidth = coord.lineWidth;\n    state.tickAlign = coord.tickAlign;\n    state.labelColor = state.color;\n    // get padding\n    if (typeof coord.padding === 'number') {\n      state.padding = Array(4).fill(coord.padding);\n    } else if (coord.padding instanceof Function) {\n      state.padding = coord.padding(state);\n    } else {\n      state.padding = coord.padding;\n    }\n    // calc font\n    if (typeof coord.fontSize === 'number') {\n      state.fontSize = coord.fontSize;\n    } else {\n      const units = parseUnit(coord.fontSize);\n      state.fontSize = units[0] * toPx(units[1]);\n    }\n    state.fontFamily = coord.fontFamily || 'sans-serif';\n    // get lines stops, including joined list of values\n    let lines;\n    if (coord.lines instanceof Function) {\n      lines = coord.lines(state);\n    } else {\n      lines = coord.lines || [];\n    }\n    state.lines = lines;\n    // calc colors\n    if (coord.lineColor instanceof Function) {\n      state.lineColors = coord.lineColor(state);\n    } else if (Array.isArray(coord.lineColor)) {\n      state.lineColors = coord.lineColor;\n    } else {\n      let color = alpha(coord.color, coord.lineColor);\n      if (typeof coord.lineColor !== 'number') {\n        color = coord.lineColor === false || coord.lineColor == null ? null : coord.color;\n      }\n      state.lineColors = Array(lines.length).fill(color);\n    }\n    // calc ticks\n    let ticks;\n    if (coord.ticks instanceof Function) {\n      ticks = coord.ticks(state);\n    } else if (Array.isArray(coord.ticks)) {\n      ticks = coord.ticks;\n    } else {\n      const tick =\n        coord.ticks === true || coord.ticks === true ? state.axisWidth * 2 : coord.ticks || 0;\n      ticks = Array(lines.length).fill(tick);\n    }\n    state.ticks = ticks;\n    // calc labels\n    let labels;\n    if (coord.labels === true) labels = state.lines;\n    else if (coord.labels instanceof Function) {\n      labels = coord.labels(state);\n    } else if (Array.isArray(coord.labels)) {\n      labels = coord.labels;\n    } else if (isObj(coord.labels)) {\n      labels = coord.labels;\n    } else {\n      labels = Array(state.lines.length).fill(null);\n    }\n    state.labels = labels;\n    // convert hashmap ticks/labels to lines + colors\n    if (isObj(ticks)) {\n      state.ticks = Array(lines.length).fill(0);\n    }\n    if (isObj(labels)) {\n      state.labels = Array(lines.length).fill(null);\n    }\n    if (isObj(ticks)) {\n      // eslint-disable-next-line guard-for-in\n      Object.keys(ticks).forEach((value, tick) => {\n        state.ticks.push(tick);\n        state.lines.push(parseFloat(value));\n        state.lineColors.push(null);\n        state.labels.push(null);\n      });\n    }\n\n    if (isObj(labels)) {\n      Object.keys(labels).forEach((label, value) => {\n        state.labels.push(label);\n        state.lines.push(parseFloat(value));\n        state.lineColors.push(null);\n        state.ticks.push(null);\n      });\n    }\n\n    return state;\n  }\n\n  setDefaults() {\n    this.pixelRatio = window.devicePixelRatio;\n    this.autostart = true;\n    this.interactions = true;\n\n    this.defaults = Object.assign(\n      {\n        type: 'linear',\n        name: '',\n        units: '',\n        state: {},\n\n        // visible range params\n        minZoom: -Infinity,\n        maxZoom: Infinity,\n        min: -Infinity,\n        max: Infinity,\n        offset: 0,\n        origin: 0.5,\n        center: {\n          x: 0,\n          y: 0,\n          zoom: 1\n        },\n        zoom: 1,\n        zoomEnabled: true,\n        panEnabled: true,\n\n        // labels\n        labels: true,\n        fontSize: '11pt',\n        fontFamily: 'sans-serif',\n        padding: 0,\n        color: 'rgb(0,0,0,1)',\n\n        // lines params\n        lines: true,\n        tick: 8,\n        tickAlign: 0.5,\n        lineWidth: 1,\n        distance: 13,\n        style: 'lines',\n        lineColor: 0.4,\n\n        // axis params\n        axis: true,\n        axisOrigin: 0,\n        axisWidth: 2,\n        axisColor: 0.8,\n\n        // stub methods\n        // return coords for the values, redefined by axes\n        getCoords: () => [0, 0, 0, 0],\n\n        // return 0..1 ratio based on value/offset/range, redefined by axes\n        getRatio: () => 0,\n\n        // default label formatter\n        format: v => v\n      },\n      gridStyle,\n      this._options\n    );\n\n    this.axisX = new Axis('x', this.defaults);\n    this.axisY = new Axis('y', this.defaults);\n\n    this.axisX = Object.assign({}, this.defaults, {\n      orientation: 'x',\n      offset: this.center.x,\n      getCoords: (values, state) => {\n        const coords = [];\n        if (!values) return coords;\n        for (let i = 0; i < values.length; i += 1) {\n          const t = state.coordinate.getRatio(values[i], state);\n          coords.push(t);\n          coords.push(0);\n          coords.push(t);\n          coords.push(1);\n        }\n        return coords;\n      },\n      getRange: state => state.shape[0] * state.coordinate.zoom,\n      // FIXME: handle infinity case here\n      getRatio: (value, state) => (value - state.offset) / state.range\n    });\n    this.axisY = Object.assign({}, this.defaults, {\n      orientation: 'y',\n      offset: this.center.y,\n      getCoords: (values, state) => {\n        const coords = [];\n        if (!values) return coords;\n        for (let i = 0; i < values.length; i += 1) {\n          const t = state.coordinate.getRatio(values[i], state);\n          coords.push(0);\n          coords.push(t);\n          coords.push(1);\n          coords.push(t);\n        }\n        return coords;\n      },\n      getRange: state => state.shape[1] * state.coordinate.zoom,\n      getRatio: (value, state) => 1 - (value - state.offset) / state.range\n    });\n\n    Object.assign(this, this.defaults);\n    Object.assign(this, this._options);\n\n    this.center = new Point(this.center);\n  }\n\n  // draw grid to the canvas\n  draw() {\n    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.drawLines(this.state.x);\n    this.drawLines(this.state.y);\n    return this;\n  }\n\n  // lines instance draw\n  drawLines(state) {\n    // draw lines and sublines\n    if (!state || !state.coordinate) return;\n\n    const ctx = this.context;\n    const [width, height] = state.shape;\n    const left = 0;\n    const top = 0;\n    const [pt, pr, pb, pl] = state.padding;\n\n    let axisRatio = state.opposite.coordinate.getRatio(state.coordinate.axisOrigin, state.opposite);\n    axisRatio = clamp(axisRatio, 0, 1);\n    const coords = state.coordinate.getCoords(state.lines, state);\n    // draw state.lines\n    ctx.lineWidth = 1; // state.lineWidth/2.;\n    for (let i = 0, j = 0; i < coords.length; i += 4, j += 1) {\n      const color = state.lineColors[j];\n      if (!color) continue;\n      ctx.strokeStyle = color;\n      ctx.beginPath();\n      const x1 = left + pl + coords[i] * (width - pr - pl);\n      const y1 = top + pt + coords[i + 1] * (height - pb - pt);\n      const x2 = left + pl + coords[i + 2] * (width - pr - pl);\n      const y2 = top + pt + coords[i + 3] * (height - pb - pt);\n      ctx.moveTo(x1, y1);\n      ctx.lineTo(x2, y2);\n      ctx.stroke();\n      ctx.closePath();\n    }\n    const normals = [];\n    for (let i = 0; i < coords.length; i += 4) {\n      const x1 = coords[i];\n      const y1 = coords[i + 1];\n      const x2 = coords[i + 2];\n      const y2 = coords[i + 3];\n      const xDif = x2 - x1;\n      const yDif = y2 - y1;\n      const dist = len(xDif, yDif);\n      normals.push(xDif / dist);\n      normals.push(yDif / dist);\n    }\n    // calc state.labels/tick coords\n    const tickCoords = [];\n    state.labelCoords = [];\n    const ticks = state.ticks;\n    for (let i = 0, j = 0, k = 0; i < normals.length; k += 1, i += 2, j += 4) {\n      const x1 = coords[j];\n      const y1 = coords[j + 1];\n      const x2 = coords[j + 2];\n      const y2 = coords[j + 3];\n      const xDif = (x2 - x1) * axisRatio;\n      const yDif = (y2 - y1) * axisRatio;\n      const tick = [\n        (normals[i] * ticks[k]) / (width - pl - pr),\n        (normals[i + 1] * ticks[k]) / (height - pt - pb)\n      ];\n      tickCoords.push(normals[i] * (xDif + tick[0] * state.tickAlign) + x1);\n      tickCoords.push(normals[i + 1] * (yDif + tick[1] * state.tickAlign) + y1);\n      tickCoords.push(normals[i] * (xDif - tick[0] * (1 - state.tickAlign)) + x1);\n      tickCoords.push(normals[i + 1] * (yDif - tick[1] * (1 - state.tickAlign)) + y1);\n      state.labelCoords.push(normals[i] * xDif + x1);\n      state.labelCoords.push(normals[i + 1] * yDif + y1);\n    }\n    // draw ticks\n    if (ticks.length) {\n      ctx.lineWidth = state.axisWidth / 2;\n      ctx.beginPath();\n      for (let i = 0, j = 0; i < tickCoords.length; i += 4, j += 1) {\n        if (almost(state.lines[j], state.opposite.coordinate.axisOrigin)) continue;\n        const x1 = left + pl + tickCoords[i] * (width - pl - pr);\n        const y1 = top + pt + tickCoords[i + 1] * (height - pt - pb);\n        const x2 = left + pl + tickCoords[i + 2] * (width - pl - pr);\n        const y2 = top + pt + tickCoords[i + 3] * (height - pt - pb);\n        ctx.moveTo(x1, y1);\n        ctx.lineTo(x2, y2);\n      }\n      ctx.strokeStyle = state.axisColor;\n      ctx.stroke();\n      ctx.closePath();\n    }\n    // draw axis\n    if (state.coordinate.axis && state.axisColor) {\n      const axisCoords = state.opposite.coordinate.getCoords(\n        [state.coordinate.axisOrigin],\n        state.opposite\n      );\n      ctx.lineWidth = state.axisWidth / 2;\n      const x1 = left + pl + clamp(axisCoords[0], 0, 1) * (width - pr - pl);\n      const y1 = top + pt + clamp(axisCoords[1], 0, 1) * (height - pt - pb);\n      const x2 = left + pl + clamp(axisCoords[2], 0, 1) * (width - pr - pl);\n      const y2 = top + pt + clamp(axisCoords[3], 0, 1) * (height - pt - pb);\n      ctx.beginPath();\n      ctx.moveTo(x1, y1);\n      ctx.lineTo(x2, y2);\n      ctx.strokeStyle = state.axisColor;\n      ctx.stroke();\n      ctx.closePath();\n    }\n    // draw state.labels\n    this.drawLabels(state);\n  }\n\n  drawLabels(state) {\n    if (state.labels) {\n      const ctx = this.context;\n      const [width, height] = state.shape;\n      const [pt, pr, pb, pl] = state.padding;\n\n      ctx.font = `300 ${state.fontSize}px ${state.fontFamily}`;\n      ctx.fillStyle = state.labelColor;\n      ctx.textBaseline = 'top';\n      const textHeight = state.fontSize;\n      const indent = state.axisWidth + 1.5;\n      const textOffset =\n        state.tickAlign < 0.5 ? -textHeight - state.axisWidth * 2 : state.axisWidth * 2;\n      const isOpp = state.coordinate.orientation === 'y' && !state.opposite.disabled;\n      for (let i = 0; i < state.labels.length; i += 1) {\n        let label = state.labels[i];\n        if (label == null) continue;\n\n        if (isOpp && almost(state.lines[i], state.opposite.coordinate.axisOrigin)) continue;\n\n        const textWidth = ctx.measureText(label).width;\n\n        let textLeft = state.labelCoords[i * 2] * (width - pl - pr) + indent + pl;\n\n        if (state.coordinate.orientation === 'y') {\n          textLeft = clamp(textLeft, indent, width - textWidth - 1 - state.axisWidth);\n          label *= -1;\n        }\n\n        let textTop = state.labelCoords[i * 2 + 1] * (height - pt - pb) + textOffset + pt;\n        if (state.coordinate.orientation === 'x') {\n          textTop = clamp(textTop, 0, height - textHeight - textOffset);\n        }\n        ctx.fillText(label, textLeft, textTop);\n      }\n    }\n  }\n}\n\nexport default Grid;\n","import { Modes } from '../core/Constants';\n\nconst ModesMixin = superclass =>\n  class extends superclass {\n    /**\n     * MODES\n     */\n    setMode(mode) {\n      this.mode = mode;\n\n      switch (mode) {\n        case Modes.SELECT:\n          this.canvas.isDrawingMode = false;\n          this.canvas.interactive = true;\n          this.canvas.selection = true;\n          this.canvas.hoverCursor = 'default';\n          this.canvas.moveCursor = 'default';\n          break;\n        case Modes.GRAB:\n          this.canvas.isDrawingMode = false;\n          this.canvas.interactive = false;\n          this.canvas.selection = false;\n          this.canvas.discardActiveObject();\n          this.canvas.hoverCursor = 'move';\n          this.canvas.moveCursor = 'move';\n          break;\n        case Modes.MEASURE:\n          this.canvas.isDrawingMode = true;\n          this.canvas.freeDrawingBrush.color = 'transparent';\n          this.canvas.discardActiveObject();\n          break;\n        case Modes.DRAW:\n          this.canvas.isDrawingMode = true;\n          break;\n\n        default:\n          break;\n      }\n    }\n\n    setModeAsDraw() {\n      this.setMode(Modes.DRAW);\n    }\n\n    setModeAsSelect() {\n      this.setMode(Modes.SELECT);\n    }\n\n    setModeAsMeasure() {\n      this.setMode(Modes.MEASURE);\n    }\n\n    setModeAsGrab() {\n      this.setMode(Modes.GRAB);\n    }\n\n    isSelectMode() {\n      return this.mode === Modes.SELECT;\n    }\n\n    isGrabMode() {\n      return this.mode === Modes.GRAB;\n    }\n\n    isMeasureMode() {\n      return this.mode === Modes.MEASURE;\n    }\n\n    isDrawMode() {\n      return this.mode === Modes.DRAW;\n    }\n  };\n\nexport default ModesMixin;\n","import { Point } from '../geometry/Point';\n\nclass Measurer {\n  constructor(options) {\n    options = options || {};\n    options.hasBorders = false;\n    options.selectable = false;\n    options.hasControls = false;\n    // options.evented = false;\n    options.class = 'measurer';\n    options.scale = options.scale || 1;\n\n    // super([], options);\n\n    this.options = options || {};\n    this.start = this.options.start;\n    this.end = this.options.end;\n\n    this.canvas = this.options.map.canvas;\n\n    this.completed = false;\n\n    if (!this.start || !this.end) {\n      throw new Error('start must be defined');\n    }\n    this.draw();\n  }\n\n  clear() {\n    if (this.objects) {\n      this.objects.forEach(object => {\n        this.canvas.remove(object);\n      });\n    }\n  }\n\n  draw() {\n    this.clear();\n\n    let { start, end } = this;\n    start = new Point(start);\n    end = new Point(end);\n\n    const center = start.add(end).multiply(0.5);\n\n    this.line = new fabric.Line([start.x, start.y, end.x, end.y], {\n      stroke: this.options.stroke || '#3e82ff',\n      hasControls: false,\n      hasBorders: false,\n      selectable: false,\n      evented: false,\n      strokeDashArray: [5, 5]\n    });\n\n    const lineEndOptions = {\n      left: start.x,\n      top: start.y,\n      strokeWidth: 1,\n      radius: this.options.radius || 1,\n      fill: this.options.fill || '#3e82ff',\n      stroke: this.options.stroke || '#3e82ff',\n      hasControls: false,\n      hasBorders: false\n    };\n\n    const lineEndOptions2 = {\n      left: start.x,\n      top: start.y,\n      strokeWidth: 1,\n      radius: this.options.radius || 5,\n      fill: this.options.fill || '#3e82ff33',\n      stroke: this.options.stroke || '#3e82ff',\n      hasControls: false,\n      hasBorders: false\n    };\n\n    this.circle1 = new fabric.Circle(lineEndOptions2);\n    this.circle2 = new fabric.Circle({\n      ...lineEndOptions2,\n      left: end.x,\n      top: end.y\n    });\n\n    this.circle11 = new fabric.Circle(lineEndOptions);\n    this.circle22 = new fabric.Circle({\n      ...lineEndOptions,\n      left: end.x,\n      top: end.y\n    });\n\n    let text = Math.round(start.distanceFrom(end));\n    text = `${text / 100} m`;\n    this.text = new fabric.Text(text, {\n      textBackgroundColor: 'black',\n      fill: 'white',\n      left: center.x,\n      top: center.y - 10,\n      fontSize: 12,\n      hasControls: false,\n      hasBorders: false,\n      selectable: false,\n      evented: false\n    });\n\n    this.objects = [this.line, this.text, this.circle11, this.circle22, this.circle1, this.circle2];\n\n    this.objects.forEach(object => {\n      this.canvas.add(object);\n    });\n\n    this.line.hasControls = false;\n    this.line.hasBorders = false;\n    this.line.selectable = false;\n    this.line.evented = false;\n\n    this.registerListeners();\n  }\n\n  setStart(start) {\n    this.start = start;\n    this.draw();\n  }\n\n  setEnd(end) {\n    this.end = end;\n    this.draw();\n  }\n\n  complete() {\n    this.completed = true;\n  }\n\n  registerListeners() {\n    this.circle2.on('moving', e => {\n      this.setEnd(e.pointer);\n    });\n\n    this.circle1.on('moving', e => {\n      this.setStart(e.pointer);\n    });\n  }\n\n  applyScale(scale) {\n    this.start.x *= scale;\n    this.start.y *= scale;\n    this.end.x *= scale;\n    this.end.y *= scale;\n    this.draw();\n  }\n\n  length() {\n    let { start, end } = this;\n    start = new Point(start);\n    end = new Point(end);\n    return start.distanceFrom(end);\n  }\n}\nexport default Measurer;\n","import Measurer from './Measurer';\n\nclass Measurement {\n  constructor(map) {\n    this.map = map;\n    this.measurer = null;\n  }\n\n  onMouseMove(e) {\n    const point = {\n      x: e.absolutePointer.x,\n      y: e.absolutePointer.y\n    };\n\n    if (this.measurer && !this.measurer.completed) {\n      this.map.emit('measure:update', this.length());\n      this.measurer.setEnd(point);\n      this.map.canvas.requestRenderAll();\n    }\n  }\n\n  onClick(e) {\n    const point = {\n      x: e.absolutePointer.x,\n      y: e.absolutePointer.y\n    };\n    if (!this.measurer) {\n      this.measurer = new Measurer({\n        start: point,\n        end: point,\n        map: this.map\n      });\n    } else if (!this.measurer.completed) {\n      this.measurer.setEnd(point);\n      this.measurer.complete();\n      this.map.emit('measure:complete', this.length());\n    }\n  }\n\n  length() {\n    if (this.measurer) {\n      return this.measurer.length();\n    }\n    return -1;\n  }\n\n  clear() {\n    if (this.measurer) {\n      this.measurer.clear();\n      this.measurer = null;\n    }\n  }\n}\n\nexport default Measurement;\n","'use strict';\n\n// used by apply() and isApplicationOf()\nconst _appliedMixin = '__mixwith_appliedMixin';\n\n/**\n * A function that returns a subclass of its argument.\n *\n * @example\n * const M = (superclass) => class extends superclass {\n *   getMessage() {\n *     return \"Hello\";\n *   }\n * }\n *\n * @typedef {Function} MixinFunction\n * @param {Function} superclass\n * @return {Function} A subclass of `superclass`\n */\n\n/**\n * Applies `mixin` to `superclass`.\n *\n * `apply` stores a reference from the mixin application to the unwrapped mixin\n * to make `isApplicationOf` and `hasMixin` work.\n *\n * This function is usefull for mixin wrappers that want to automatically enable\n * {@link hasMixin} support.\n *\n * @example\n * const Applier = (mixin) => wrap(mixin, (superclass) => apply(superclass, mixin));\n *\n * // M now works with `hasMixin` and `isApplicationOf`\n * const M = Applier((superclass) => class extends superclass {});\n *\n * class C extends M(Object) {}\n * let i = new C();\n * hasMixin(i, M); // true\n *\n * @function\n * @param {Function} superclass A class or constructor function\n * @param {MixinFunction} mixin The mixin to apply\n * @return {Function} A subclass of `superclass` produced by `mixin`\n */\nexport const apply = (superclass, mixin) => {\n  let application = mixin(superclass);\n  application.prototype[_appliedMixin] = unwrap(mixin);\n  return application;\n};\n\n/**\n * Returns `true` iff `proto` is a prototype created by the application of\n * `mixin` to a superclass.\n *\n * `isApplicationOf` works by checking that `proto` has a reference to `mixin`\n * as created by `apply`.\n *\n * @function\n * @param {Object} proto A prototype object created by {@link apply}.\n * @param {MixinFunction} mixin A mixin function used with {@link apply}.\n * @return {boolean} whether `proto` is a prototype created by the application of\n * `mixin` to a superclass\n */\nexport const isApplicationOf = (proto, mixin) =>\n  proto.hasOwnProperty(_appliedMixin) && proto[_appliedMixin] === unwrap(mixin);\n\n/**\n * Returns `true` iff `o` has an application of `mixin` on its prototype\n * chain.\n *\n * @function\n * @param {Object} o An object\n * @param {MixinFunction} mixin A mixin applied with {@link apply}\n * @return {boolean} whether `o` has an application of `mixin` on its prototype\n * chain\n */\nexport const hasMixin = (o, mixin) => {\n  while (o != null) {\n    if (isApplicationOf(o, mixin)) return true;\n    o = Object.getPrototypeOf(o);\n  }\n  return false;\n}\n\n\n// used by wrap() and unwrap()\nconst _wrappedMixin = '__mixwith_wrappedMixin';\n\n/**\n * Sets up the function `mixin` to be wrapped by the function `wrapper`, while\n * allowing properties on `mixin` to be available via `wrapper`, and allowing\n * `wrapper` to be unwrapped to get to the original function.\n *\n * `wrap` does two things:\n *   1. Sets the prototype of `mixin` to `wrapper` so that properties set on\n *      `mixin` inherited by `wrapper`.\n *   2. Sets a special property on `mixin` that points back to `mixin` so that\n *      it can be retreived from `wrapper`\n *\n * @function\n * @param {MixinFunction} mixin A mixin function\n * @param {MixinFunction} wrapper A function that wraps {@link mixin}\n * @return {MixinFunction} `wrapper`\n */\nexport const wrap = (mixin, wrapper) => {\n  Object.setPrototypeOf(wrapper, mixin);\n  if (!mixin[_wrappedMixin]) {\n    mixin[_wrappedMixin] = mixin;\n  }\n  return wrapper;\n};\n\n/**\n * Unwraps the function `wrapper` to return the original function wrapped by\n * one or more calls to `wrap`. Returns `wrapper` if it's not a wrapped\n * function.\n *\n * @function\n * @param {MixinFunction} wrapper A wrapped mixin produced by {@link wrap}\n * @return {MixinFunction} The originally wrapped mixin\n */\nexport const unwrap = (wrapper) => wrapper[_wrappedMixin] || wrapper;\n\nconst _cachedApplications = '__mixwith_cachedApplications';\n\n/**\n * Decorates `mixin` so that it caches its applications. When applied multiple\n * times to the same superclass, `mixin` will only create one subclass, memoize\n * it and return it for each application.\n *\n * Note: If `mixin` somehow stores properties its classes constructor (static\n * properties), or on its classes prototype, it will be shared across all\n * applications of `mixin` to a super class. It's reccomended that `mixin` only\n * access instance state.\n *\n * @function\n * @param {MixinFunction} mixin The mixin to wrap with caching behavior\n * @return {MixinFunction} a new mixin function\n */\nexport const Cached = (mixin) => wrap(mixin, (superclass) => {\n  // Get or create a symbol used to look up a previous application of mixin\n  // to the class. This symbol is unique per mixin definition, so a class will have N\n  // applicationRefs if it has had N mixins applied to it. A mixin will have\n  // exactly one _cachedApplicationRef used to store its applications.\n\n  let cachedApplications = superclass[_cachedApplications];\n  if (!cachedApplications) {\n    cachedApplications = superclass[_cachedApplications] = new Map();\n  }\n\n  let application = cachedApplications.get(mixin);\n  if (!application) {\n    application = mixin(superclass);\n    cachedApplications.set(mixin, application);\n  }\n\n  return application;\n});\n\n/**\n * Decorates `mixin` so that it only applies if it's not already on the\n * prototype chain.\n *\n * @function\n * @param {MixinFunction} mixin The mixin to wrap with deduplication behavior\n * @return {MixinFunction} a new mixin function\n */\nexport const DeDupe = (mixin) => wrap(mixin, (superclass) =>\n    (hasMixin(superclass.prototype, mixin))\n      ? superclass\n      : mixin(superclass));\n\n/**\n * Adds [Symbol.hasInstance] (ES2015 custom instanceof support) to `mixin`.\n *\n * @function\n * @param {MixinFunction} mixin The mixin to add [Symbol.hasInstance] to\n * @return {MixinFunction} the given mixin function\n */\nexport const HasInstance = (mixin) => {\n  if (Symbol && Symbol.hasInstance && !mixin[Symbol.hasInstance]) {\n    Object.defineProperty(mixin, Symbol.hasInstance, {\n      value(o) {\n        return hasMixin(o, mixin);\n      },\n    });\n  }\n  return mixin;\n};\n\n/**\n * A basic mixin decorator that applies the mixin with {@link apply} so that it\n * can be used with {@link isApplicationOf}, {@link hasMixin} and the other\n * mixin decorator functions.\n *\n * @function\n * @param {MixinFunction} mixin The mixin to wrap\n * @return {MixinFunction} a new mixin function\n */\nexport const BareMixin = (mixin) => wrap(mixin, (s) => apply(s, mixin));\n\n/**\n * Decorates a mixin function to add deduplication, application caching and\n * instanceof support.\n *\n * @function\n * @param {MixinFunction} mixin The mixin to wrap\n * @return {MixinFunction} a new mixin function\n */\nexport const Mixin = (mixin) => DeDupe(Cached(BareMixin(mixin)));\n\n/**\n * A fluent interface to apply a list of mixins to a superclass.\n *\n * ```javascript\n * class X extends mix(Object).with(A, B, C) {}\n * ```\n *\n * The mixins are applied in order to the superclass, so the prototype chain\n * will be: X->C'->B'->A'->Object.\n *\n * This is purely a convenience function. The above example is equivalent to:\n *\n * ```javascript\n * class X extends C(B(A(Object))) {}\n * ```\n *\n * @function\n * @param {Function} [superclass=Object]\n * @return {MixinBuilder}\n */\nexport const mix = (superclass) => new MixinBuilder(superclass);\n\nclass MixinBuilder {\n\n  constructor(superclass) {\n    this.superclass = superclass || class {};\n  }\n\n  /**\n   * Applies `mixins` in order to the superclass given to `mix()`.\n   *\n   * @param {Array.<Mixin>} mixins\n   * @return {Function} a subclass of `superclass` with `mixins` applied\n   */\n  with(...mixins) {\n    return mixins.reduce((c, m) => m(c), this.superclass);\n  }\n}","import panzoom from '../lib/panzoom';\nimport { clamp } from '../lib/mumath/index';\n\nimport Base from '../core/Base';\nimport { MAP, Modes } from '../core/Constants';\nimport Grid from '../grid/Grid';\nimport { Point } from '../geometry/Point';\nimport ModesMixin from './ModesMixin';\nimport Measurement from '../measurement/Measurement';\nimport { mix } from '../lib/mix';\n\nexport class Map extends mix(Base).with(ModesMixin) {\n  constructor(container, options) {\n    super(options);\n\n    this.defaults = Object.assign({}, MAP);\n\n    // set defaults\n    Object.assign(this, this.defaults);\n\n    // overwrite options\n    Object.assign(this, this._options);\n\n    this.center = new Point(this.center);\n\n    this.container = container || document.body;\n\n    const canvas = document.createElement('canvas');\n    this.container.appendChild(canvas);\n    canvas.setAttribute('id', 'indoors-map-canvas');\n\n    canvas.width = this.width || this.container.clientWidth;\n    canvas.height = this.height || this.container.clientHeight;\n\n    this.canvas = new fabric.Canvas(canvas, {\n      preserveObjectStacking: true,\n      renderOnAddRemove: true\n    });\n    this.context = this.canvas.getContext('2d');\n\n    this.on('render', () => {\n      if (this.autostart) this.clear();\n    });\n\n    this.originX = -this.canvas.width / 2;\n    this.originY = -this.canvas.height / 2;\n\n    this.canvas.absolutePan({\n      x: this.originX,\n      y: this.originY\n    });\n\n    // this.center = {\n    //   x: this.canvas.width / 2.0,\n    //   y: this.canvas.height / 2.0\n    // };\n\n    this.x = this.center.x;\n    this.y = this.center.y;\n    this.dx = 0;\n    this.dy = 0;\n\n    this.padding = this.padding || [0, 0, 0, 0];\n\n    try {\n      this.addFloorPlan();\n    } catch (e) {\n      console.error(e);\n    }\n\n    if (this.showGrid) {\n      this.addGrid();\n    }\n\n    this.setMode(this.mode || Modes.GRAB);\n\n    const vm = this;\n    panzoom(this.container, e => {\n      vm.panzoom(e);\n    });\n\n    this.registerListeners();\n\n    setTimeout(() => {\n      this.emit('ready', this);\n    }, 300);\n\n    this.measurement = new Measurement(this);\n  }\n\n  addFloorPlan() {\n    if (!this.floorplan) return;\n    const vm = this;\n    this.floorplan.on('load', img => {\n      vm.addLayer(img);\n    });\n  }\n\n  addLayer(layer) {\n    // this.canvas.renderOnAddRemove = false;\n    if (!layer.shape) {\n      console.error('shape is undefined');\n      return;\n    }\n    this.canvas.add(layer.shape);\n    this.canvas._objects.sort((o1, o2) => o1.zIndex - o2.zIndex);\n\n    if (layer.shape.keepOnZoom) {\n      const scale = 1.0 / this.zoom;\n      layer.shape.set('scaleX', scale);\n      layer.shape.set('scaleY', scale);\n      layer.shape.setCoords();\n      this.emit(`${layer.class}scaling`, layer);\n    }\n    if (layer.class) {\n      this.emit(`${layer.class}:added`, layer);\n    }\n\n    // this.canvas.renderOnAddRemove = true;\n\n    // this.update();\n    this.calculateMaxZoom();\n    this.canvas.requestRenderAll();\n  }\n\n  removeLayer(layer) {\n    if (!layer || !layer.shape) return;\n    if (layer.class) {\n      this.emit(`${layer.class}:removed`, layer);\n    }\n    this.canvas.remove(layer.shape);\n  }\n\n  addGrid() {\n    this.gridCanvas = this.cloneCanvas();\n    this.gridCanvas.setAttribute('id', 'indoors-grid-canvas');\n    const options = {\n      center: this.center\n    };\n    this.grid = new Grid(this.gridCanvas, options);\n    this.grid.draw();\n  }\n\n  moveTo(obj, index) {\n    if (index !== undefined) {\n      obj.zIndex = index;\n    }\n    this.canvas.moveTo(obj.shape, obj.zIndex);\n  }\n\n  cloneCanvas(canvas) {\n    canvas = canvas || this.canvas;\n    const clone = document.createElement('canvas');\n    clone.width = canvas.width;\n    clone.height = canvas.height;\n    canvas.wrapperEl.appendChild(clone);\n    return clone;\n  }\n\n  setZoom(zoom) {\n    const { width, height } = this.canvas;\n    this.zoom = clamp(zoom, this.minZoom, this.maxZoom);\n    this.dx = 0;\n    this.dy = 0;\n    this.x = width / 2.0;\n    this.y = height / 2.0;\n    this.update();\n    process.nextTick(() => {\n      this.update();\n    });\n  }\n\n  getBoundingBox() {\n    let minX = Infinity;\n    let maxX = -Infinity;\n    let minY = Infinity;\n    let maxY = -Infinity;\n\n    this.canvas.forEachObject(obj => {\n      const coords = obj.getBounds();\n\n      coords.forEach(point => {\n        minX = Math.min(minX, point.x);\n        maxX = Math.max(maxX, point.x);\n        minY = Math.min(minY, point.y);\n        maxY = Math.max(maxY, point.y);\n      });\n    });\n\n    return {\n      left: minX,\n      right: maxX,\n      top: minY,\n      bottom: maxY\n    };\n  }\n\n  getObjectTransformPositionById(objectId) {\n    const group = this.canvas.getObjects().find(item => item.id === objectId);\n    return group && group.getTransformPosition();\n  }\n\n  transformPoint(point) {\n    return fabric.util.transformPoint(point, this.canvas.viewportTransform);\n  }\n\n  getPointerLength(num) {\n    return Math.abs(this.getPointer({ x: 0, y: 0 }).x - this.getPointer({ x: num, y: 0 }).x);\n  }\n\n  getPointer(point, ignoreZoom) {\n    const element = this.container;\n    const scroll = fabric.util.getElementOffset(element);\n    let pointer = {\n      x: point.x + scroll.left,\n      y: point.y + scroll.top\n    };\n\n    const upperCanvasEl = this.canvas.upperCanvasEl;\n    const bounds = upperCanvasEl.getBoundingClientRect();\n    let boundsWidth = bounds.width || 0;\n    let boundsHeight = bounds.height || 0;\n    let cssScale;\n\n    if (!boundsWidth || !boundsHeight) {\n      if ('top' in bounds && 'bottom' in bounds) {\n        boundsHeight = Math.abs(bounds.top - bounds.bottom);\n      }\n      if ('right' in bounds && 'left' in bounds) {\n        boundsWidth = Math.abs(bounds.right - bounds.left);\n      }\n    }\n\n    this.canvas.calcOffset();\n    pointer.x -= this.canvas._offset.left;\n    pointer.y -= this.canvas._offset.top;\n    if (!ignoreZoom) {\n      pointer = this.canvas.restorePointerVpt(pointer);\n    }\n\n    const retinaScaling = this.canvas.getRetinaScaling();\n    if (retinaScaling !== 1) {\n      pointer.x /= retinaScaling;\n      pointer.y /= retinaScaling;\n    }\n\n    if (boundsWidth === 0 || boundsHeight === 0) {\n      // If bounds are not available (i.e. not visible), do not apply scale.\n      cssScale = { width: 1, height: 1 };\n    } else {\n      cssScale = {\n        width: upperCanvasEl.width / boundsWidth,\n        height: upperCanvasEl.height / boundsHeight\n      };\n    }\n\n    return {\n      x: pointer.x * cssScale.width,\n      y: pointer.y * cssScale.height\n    };\n  }\n\n  setCursor(cursor) {\n    this.container.style.cursor = cursor;\n  }\n\n  reset() {\n    const { width, height } = this.canvas;\n    this.zoom = this._options.zoom || 1;\n    this.center = new Point();\n    this.originX = -width / 2;\n    this.originY = -height / 2;\n    this.canvas.absolutePan({\n      x: this.originX,\n      y: this.originY\n    });\n    this.x = width / 2.0;\n    this.y = height / 2.0;\n    this.update();\n    process.nextTick(() => {\n      this.update();\n    });\n  }\n\n  onResize(width, height) {\n    const oldWidth = this.canvas.width;\n    const oldHeight = this.canvas.height;\n\n    // const point = this.getPointer(this.center);\n\n    width = width || this.container.clientWidth;\n    height = height || this.container.clientHeight;\n\n    this.canvas.setWidth(width);\n    this.canvas.setHeight(height);\n\n    if (this.grid) {\n      this.grid.setSize(width, height);\n    }\n\n    const dx = width / 2.0 - oldWidth / 2.0;\n    const dy = height / 2.0 - oldHeight / 2.0;\n\n    this.canvas.relativePan({\n      x: dx,\n      y: dy\n    });\n\n    this.update();\n\n    // this.setView(this.center);\n  }\n\n  fitBounds(padding = 100) {\n    // this.onResize();\n\n    // if (this.bounds) {\n    //   this.zoom = 1 / this.maxZoom;\n    //   return;\n    // }\n\n    const { width, height } = this.canvas;\n\n    this.originX = -width / 2;\n    this.originY = -height / 2;\n\n    const boundingBox = this.getBoundingBox();\n    const { left, right, top, bottom } = boundingBox;\n\n    this.center.x = (left + right) / 2.0;\n    this.center.y = -(top + bottom) / 2.0;\n\n    const boundWidth = Math.abs(left - right) + padding;\n    const boundHeight = Math.abs(top - bottom) + padding;\n    const scaleX = width / boundWidth;\n    const scaleY = height / boundHeight;\n\n    this.zoom = Math.max(scaleX, scaleY);\n\n    this.canvas.setZoom(this.zoom);\n\n    this.canvas.absolutePan({\n      x: this.originX + this.center.x * this.zoom,\n      y: this.originY - this.center.y * this.zoom\n    });\n\n    this.update();\n    process.nextTick(() => {\n      this.update();\n    });\n  }\n\n  calculateMaxZoom() {\n    if (!this.bounds) return false;\n    const { height, width } = this.canvas;\n\n    let { left, right, top, bottom } = this.getBoundingBox();\n\n    if (left === Infinity) return false;\n\n    const [pt, pr, pb, pl] = this.boundsPadding;\n    left -= this.getPointerLength(pl);\n    right += this.getPointerLength(pr);\n    top -= this.getPointerLength(pt);\n    bottom += this.getPointerLength(pb);\n\n    const boundingBoxWidth = Math.abs(left - right) - 10;\n    const boundingBoxHeight = Math.abs(top - bottom) - 10;\n\n    const scaleX = width / boundingBoxWidth;\n    const scaleY = height / boundingBoxHeight;\n    const scale = Math.max(scaleX, scaleY);\n\n    if (1 / scale !== this.maxZoom) {\n      this.maxZoom = 1 / scale;\n\n      if (1 / this.zoom > this.maxZoom) {\n        this.zoom = 1 / this.maxZoom;\n        this.canvas.setZoom(this.zoom);\n        this.canvas.absolutePan({\n          x: this.originX + this.center.x * this.zoom,\n          y: this.originY - this.center.y * this.zoom\n        });\n      }\n    }\n\n    const topLeft = this.getPointer({ x: 0, y: 0 });\n    const bottomRight = this.getPointer({ x: width, y: height });\n\n    let limited = false;\n\n    let diff = left - topLeft.x;\n\n    if (diff > 0) {\n      this.center.x += diff;\n      this.dx = 0;\n      limited = true;\n    }\n\n    diff = right - bottomRight.x;\n    if (diff < 0) {\n      this.center.x += diff;\n      this.dx = 0;\n      limited = true;\n    }\n    diff = top - topLeft.y;\n    if (diff > 0) {\n      this.center.y -= diff;\n      this.dy = 0;\n      limited = true;\n    }\n\n    diff = bottom - bottomRight.y;\n\n    if (diff < 0) {\n      this.center.y -= diff;\n      this.dy = 0;\n      limited = true;\n    }\n\n    if (limited) {\n      this.canvas.absolutePan({\n        x: this.originX + this.center.x * this.zoom,\n        y: this.originY - this.center.y * this.zoom\n      });\n    }\n\n    // this.canvas.setZoom(this.zoom);\n    // this.canvas.absolutePan({\n    //   x: this.originX + this.center.x * this.zoom,\n    //   y: this.originY - this.center.y * this.zoom\n    // });\n\n    // console.log('x = ', this.x);\n    // console.log('dx = ', this.dx);\n    // console.log('center.x = ', this.center.x);\n    // console.log('originX = ', this.originX);\n    // console.log('boundingBox.left = ', left);\n    // console.log('boundingBox.top = ', top);\n    // console.log('topLeft.x = ', topLeft.x);\n    // console.log('topLeft.y = ', topLeft.y);\n    // console.log('width = ', bottomRight.x - topLeft.x);\n    // console.log('viewportTransform = ', this.canvas.viewportTransform);\n\n    this.limited = limited;\n    return limited;\n  }\n\n  update() {\n    const canvas = this.canvas;\n\n    this.calculateMaxZoom();\n\n    if (this.grid) {\n      this.grid.update2({\n        x: this.center.x,\n        y: this.center.y,\n        zoom: this.zoom\n      });\n      this.grid.render();\n    }\n\n    this.emit('update', this);\n    canvas.zoomToPoint(new Point(this.x, this.y), this.zoom);\n\n    if (this.isGrabMode() || this.isRight) {\n      canvas.relativePan(new Point(this.dx, this.dy));\n      this.emit('panning');\n      this.setCursor('grab');\n    } else {\n      this.setCursor('pointer');\n    }\n\n    const now = Date.now();\n    if (!this.lastUpdatedTime && Math.abs(this.lastUpdatedTime - now) < 100) {\n      return;\n    }\n    this.lastUpdatedTime = now;\n\n    const objects = canvas.getObjects();\n    let hasKeepZoom = false;\n    for (let i = 0; i < objects.length; i += 1) {\n      const object = objects[i];\n      if (object.keepOnZoom) {\n        object.set('scaleX', 1.0 / this.zoom);\n        object.set('scaleY', 1.0 / this.zoom);\n        object.setCoords();\n        hasKeepZoom = true;\n        this.emit(`${object.class}scaling`, object);\n      }\n    }\n    if (hasKeepZoom) canvas.requestRenderAll();\n  }\n\n  panzoom(e) {\n    // if (this.limited) return;\n    // enable interactions\n    const { width, height } = this.canvas;\n    // shift start\n    const zoom = clamp(-e.dz, -height * 0.75, height * 0.75) / height;\n\n    const prevZoom = 1 / this.zoom;\n    let curZoom = prevZoom * (1 - zoom);\n    curZoom = clamp(curZoom, this.minZoom, this.maxZoom);\n\n    let { x, y } = this.center;\n\n    // pan\n    const oX = 0.5;\n    const oY = 0.5;\n    if (this.isGrabMode() || e.isRight) {\n      x -= prevZoom * e.dx;\n      y += prevZoom * e.dy;\n      this.setCursor('grab');\n    } else {\n      this.setCursor('pointer');\n    }\n\n    if (this.zoomEnabled) {\n      const tx = e.x / width - oX;\n      x -= width * (curZoom - prevZoom) * tx;\n      const ty = oY - e.y / height;\n      y -= height * (curZoom - prevZoom) * ty;\n    }\n\n    this.center.setX(x);\n    this.center.setY(y);\n    this.zoom = 1 / curZoom;\n    this.dx = e.dx;\n    this.dy = e.dy;\n    this.x = e.x0;\n    this.y = e.y0;\n    this.isRight = e.isRight;\n    this.update();\n  }\n\n  setView(view) {\n    this.dx = 0;\n    this.dy = 0;\n    this.x = 0;\n    this.y = 0;\n    view.y *= -1;\n\n    const dx = this.center.x - view.x;\n    const dy = -this.center.y + view.y;\n\n    this.center.copy(view);\n\n    this.canvas.relativePan(new Point(dx * this.zoom, dy * this.zoom));\n\n    this.canvas.renderAll();\n\n    this.update();\n\n    process.nextTick(() => {\n      this.update();\n    });\n  }\n\n  registerListeners() {\n    const vm = this;\n\n    this.canvas.on('object:scaling', e => {\n      if (e.target.class) {\n        vm.emit(`${e.target.class}:scaling`, e.target.parent);\n        e.target.parent.emit('scaling', e.target.parent);\n        return;\n      }\n      const group = e.target;\n      if (!group.getObjects) return;\n\n      const objects = group.getObjects();\n      group.removeWithUpdate();\n      for (let i = 0; i < objects.length; i += 1) {\n        const object = objects[i];\n        object.orgYaw = object.parent.yaw || 0;\n        object.fire('moving', object.parent);\n        vm.emit(`${object.class}:moving`, object.parent);\n      }\n      vm.update();\n      vm.canvas.requestRenderAll();\n    });\n\n    this.canvas.on('object:rotating', e => {\n      if (e.target.class) {\n        vm.emit(`${e.target.class}:rotating`, e.target.parent, e.target.angle);\n        e.target.parent.emit('rotating', e.target.parent, e.target.angle);\n        return;\n      }\n      const group = e.target;\n      if (!group.getObjects) return;\n      const objects = group.getObjects();\n      for (let i = 0; i < objects.length; i += 1) {\n        const object = objects[i];\n        if (object.class === 'marker') {\n          object._set('angle', -group.angle);\n          object.parent.yaw = -group.angle + (object.orgYaw || 0);\n          // object.orgYaw = object.parent.yaw;\n          object.fire('moving', object.parent);\n          vm.emit(`${object.class}:moving`, object.parent);\n          object.fire('rotating', object.parent);\n          vm.emit(`${object.class}:rotating`, object.parent);\n        }\n      }\n      this.update();\n    });\n\n    this.canvas.on('object:moving', e => {\n      if (e.target.class) {\n        vm.emit(`${e.target.class}:moving`, e.target.parent);\n        e.target.parent.emit('moving', e.target.parent);\n        return;\n      }\n      const group = e.target;\n      if (!group.getObjects) return;\n      const objects = group.getObjects();\n      for (let i = 0; i < objects.length; i += 1) {\n        const object = objects[i];\n        if (object.class) {\n          object.fire('moving', object.parent);\n          vm.emit(`${object.class}:moving`, object.parent);\n        }\n      }\n      this.update();\n    });\n\n    this.canvas.on('object:moved', e => {\n      if (e.target.class) {\n        vm.emit(`${e.target.class}dragend`, e);\n        vm.emit(`${e.target.class}:moved`, e.target.parent);\n        e.target.parent.emit('moved', e.target.parent);\n        this.update();\n        return;\n      }\n      const group = e.target;\n      if (!group.getObjects) return;\n      const objects = group.getObjects();\n      for (let i = 0; i < objects.length; i += 1) {\n        const object = objects[i];\n        if (object.class) {\n          object.fire('moved', object.parent);\n          vm.emit(`${object.class}:moved`, object.parent);\n        }\n      }\n      this.update();\n    });\n\n    this.canvas.on('selection:cleared', e => {\n      const objects = e.deselected;\n      if (!objects || !objects.length) return;\n      for (let i = 0; i < objects.length; i += 1) {\n        const object = objects[i];\n        if (object.class === 'marker') {\n          object._set('angle', 0);\n          object._set('scaleX', 1 / vm.zoom);\n          object._set('scaleY', 1 / vm.zoom);\n          if (object.parent) {\n            object.parent.inGroup = false;\n          }\n          object.fire('moving', object.parent);\n        }\n      }\n    });\n    this.canvas.on('selection:created', e => {\n      const objects = e.selected;\n      if (!objects || objects.length < 2) return;\n      for (let i = 0; i < objects.length; i += 1) {\n        const object = objects[i];\n        if (object.class && object.parent) {\n          object.parent.inGroup = true;\n          object.orgYaw = object.parent.yaw || 0;\n        }\n      }\n    });\n    this.canvas.on('selection:updated', e => {\n      const objects = e.selected;\n      if (!objects || objects.length < 2) return;\n      for (let i = 0; i < objects.length; i += 1) {\n        const object = objects[i];\n        if (object.class && object.parent) {\n          object.parent.inGroup = true;\n          object.orgYaw = object.parent.yaw || 0;\n        }\n      }\n    });\n\n    this.canvas.on('mouse:down', e => {\n      vm.dragObject = e.target;\n      vm.mouseMove = false;\n    });\n\n    this.canvas.on('mouse:move', e => {\n      if (this.isMeasureMode()) {\n        this.measurement.onMouseMove(e);\n      }\n      if (vm.dragObject && vm.dragObject.clickable) {\n        if (vm.dragObject === e.target) {\n          vm.dragObject.dragging = true;\n        } else {\n          vm.dragObject.dragging = false;\n        }\n      }\n      this.isRight = false;\n      if ('which' in e.e) {\n        // Gecko (Firefox), WebKit (Safari/Chrome) & Opera\n        this.isRight = e.e.which === 3;\n      } else if ('button' in e.e) {\n        // IE, Opera\n        this.isRight = e.e.button === 2;\n      }\n\n      vm.mouseMove = true;\n      vm.emit('mouse:move', e);\n    });\n\n    this.canvas.on('mouse:up', e => {\n      if (this.isMeasureMode()) {\n        this.measurement.onClick(e);\n      }\n\n      this.isRight = false;\n      this.dx = 0;\n      this.dy = 0;\n\n      if (!vm.dragObject || !e.target || !e.target.selectable) {\n        e.target = null;\n        if (!vm.mouseMove) {\n          vm.emit('mouse:click', e);\n        }\n      }\n      if (vm.dragObject && vm.dragObject.clickable) {\n        if (vm.dragObject !== e.target) return;\n        if (!vm.dragObject.dragging && !vm.modeToggleByKey) {\n          vm.emit(`${vm.dragObject.class}:click`, vm.dragObject.parent);\n        }\n        vm.dragObject.dragging = false;\n      }\n      vm.dragObject = null;\n    });\n\n    window.addEventListener('resize', () => {\n      vm.onResize();\n    });\n\n    // document.addEventListener('keyup', () => {\n    //   if (this.modeToggleByKey && this.isGrabMode()) {\n    //     this.setModeAsSelect();\n    //     this.modeToggleByKey = false;\n    //   }\n    // });\n\n    // document.addEventListener('keydown', event => {\n    //   if (event.ctrlKey || event.metaKey) {\n    //     if (this.isSelectMode()) {\n    //       this.setModeAsGrab();\n    //     }\n    //     this.modeToggleByKey = true;\n    //   }\n    // });\n  }\n\n  unregisterListeners() {\n    this.canvas.off('object:moving');\n    this.canvas.off('object:moved');\n  }\n\n  getMarkerById(id) {\n    const objects = this.canvas.getObjects();\n    for (let i = 0; i < objects.length; i += 1) {\n      const obj = objects[i];\n      if (obj.class === 'marker' && obj.id === id) {\n        return obj.parent;\n      }\n    }\n    return null;\n  }\n\n  getMarkers() {\n    const list = [];\n    const objects = this.canvas.getObjects();\n    for (let i = 0; i < objects.length; i += 1) {\n      const obj = objects[i];\n      if (obj.class === 'marker') {\n        list.push(obj.parent);\n      }\n    }\n    return list;\n  }\n}\n\nexport const map = (container, options) => new Map(container, options);\n","import { Point } from '../geometry/Point';\n\nexport class Group extends fabric.Group {\n  constructor(objects, options) {\n    options = options || {};\n    super(objects, options);\n  }\n\n  getBounds() {\n    const coords = [];\n    coords.push(new Point(this.left - this.width / 2.0, this.top - this.height / 2.0));\n    coords.push(new Point(this.left + this.width / 2.0, this.top + this.height / 2.0));\n    return coords;\n  }\n\n  getTransformPosition() {\n    if (this.canvas) {\n      return fabric.util.transformPoint(this.getCenterPoint(), this.canvas.viewportTransform);\n    }\n    return null;\n  }\n}\n\nexport const group = (objects, options) => new Group(objects, options);\n\nexport default Group;\n","import Base from '../core/Base';\n\nexport class Layer extends Base {\n  constructor(options) {\n    super(options);\n    this.label = this.label !== undefined ? this.label : null;\n    this.draggable = this.draggable || false;\n    this.zIndex = this.zIndex || 1;\n    this.opacity = this.opacity || 1;\n    this.keepOnZoom = this.keepOnZoom || false;\n    this.clickable = this.clickable || false;\n\n    this.hoverCursor = this.hoverCursor || this.clickable ? 'pointer' : 'default';\n    this.moveCursor = this.moveCursor || 'move';\n\n    // this.class = this.class || this.constructor.name.toLowerCase();\n\n    this.style = {\n      zIndex: this.zIndex,\n      class: this.class,\n      parent: this,\n      keepOnZoom: this.keepOnZoom,\n      id: this.id,\n      hasControls: false,\n      hasBorders: false,\n      lockMovementX: !this.draggable,\n      lockMovementY: !this.draggable,\n      draggable: this.draggable,\n      clickable: this.clickable,\n      evented: this.clickable,\n      selectable: this.draggable,\n      hoverCursor: this.hoverCursor,\n      moveCursor: this.moveCursor\n    };\n  }\n\n  setOptions(options) {\n    if (!this.shape) return;\n    Object.keys(options).forEach(key => {\n      this.shape.set(key, options[key]);\n    });\n    if (this.shape.canvas) {\n      this.shape.canvas.renderAll();\n    }\n  }\n\n  addTo(map) {\n    if (!map) {\n      if (this._map) {\n        this._map.removeLayer(this);\n      }\n      return;\n    }\n    this._map = map;\n    this._map.addLayer(this);\n  }\n}\n\nexport const layer = options => new Layer(options);\n\nexport default Layer;\n","import { Point } from '../geometry/Point';\nimport { Group } from '../layer/Group';\nimport { Layer } from '../layer/Layer';\n\nexport class Floor extends Layer {\n  constructor(options) {\n    super(options);\n\n    this.width = this.width || -1;\n    this.height = this.height || -1;\n\n    this.position = new Point(this.position);\n\n    this.class = 'floorplan';\n\n    this.load();\n  }\n\n  load() {\n    const vm = this;\n    const index = this.url.lastIndexOf('.');\n    const ext = this.url.substr(index + 1, 3);\n\n    if (ext === 'svg') {\n      fabric.loadSVGFromURL(this.url, (objects, options) => {\n        objects = objects.filter(e => e.id !== 'grid');\n        const image = fabric.util.groupSVGElements(objects, options);\n        vm.setImage(image);\n      });\n    } else {\n      fabric.Image.fromURL(\n        this.url,\n        image => {\n          vm.setImage(image);\n        },\n        {\n          selectable: false,\n          opacity: this.opacity\n        }\n      );\n    }\n\n    this.handler = new fabric.Rect({\n      left: 0,\n      top: 0,\n      width: 0.1,\n      height: 0.1,\n      stroke: 'black',\n      fill: '',\n      hasControls: false,\n      hasBorders: false\n    });\n  }\n\n  setImage(image) {\n    if (this.shape && this.image) {\n      this.shape.remove(this.image);\n    }\n    const ratio = image.width / image.height;\n    if (this.width === -1 && this.height === -1) {\n      this.width = image.width;\n      this.height = image.height;\n    } else if (this.width === -1) {\n      this.width = this.height * ratio;\n    } else if (this.height === -1) {\n      this.height = this.width / ratio;\n    }\n    image.originalWidth = image.width;\n    image.originalHeight = image.height;\n    this.image = image.scaleToWidth(this.width, true);\n\n    this.scaleX = image.scaleX + 0;\n    this.scaleY = image.scaleY + 0;\n\n    this.drawShape();\n  }\n\n  drawShape() {\n    if (this.shape) {\n      this.shape.addWithUpdate(this.image);\n      this.emit('load', this);\n      return;\n    }\n\n    this.shape = new Group([this.image, this.handler], {\n      selectable: false,\n      draggable: false,\n      left: this.position.x,\n      top: this.position.y,\n      parent: this,\n      lockMovementX: true,\n      lockMovementY: true,\n      class: this.class,\n      zIndex: this.zIndex\n    });\n    this.emit('load', this);\n  }\n\n  setWidth(width) {\n    this.width = width;\n    this.onResize();\n  }\n\n  setHeight(height) {\n    this.height = height;\n    this.onResize();\n  }\n\n  setOpacity(opacity) {\n    this.opacity = opacity;\n    this.image.set('opacity', opacity);\n    if (this.image.canvas) {\n      this.image.canvas.renderAll();\n    }\n  }\n\n  setPosition(position) {\n    this.position = new Point(position);\n    if (!this.shape) return;\n    this.shape.set({\n      left: this.position.x,\n      top: this.position.y\n    });\n  }\n\n  setUrl(url) {\n    this.url = url;\n    this.load();\n  }\n\n  onResize(width, height) {\n    if (width !== undefined) {\n      this.width = width;\n    }\n    if (height !== undefined) {\n      this.height = height;\n    }\n\n    const ratio = this.image.width / this.image.height;\n    if (this.width === -1 && this.height === -1) {\n      this.width = this.image.width;\n      this.height = this.image.height;\n    } else if (this.width === -1) {\n      this.width = this.height / ratio;\n    } else if (this.height === -1) {\n      this.height = this.width * ratio;\n    }\n    this.image = this.image.scaleToWidth(this.width);\n    this.shape.addWithUpdate();\n  }\n}\n\nexport const floorplan = options => new Floor(options);\n","export class Line extends fabric.Line {\n  constructor(points, options) {\n    options = options || {};\n    options.strokeWidth = options.strokeWidth || 1;\n    options.class = 'line';\n    super(points, options);\n    this._strokeWidth = options.strokeWidth;\n  }\n\n  _renderStroke(ctx) {\n    const stroke = this._strokeWidth / this.canvas.getZoom();\n    this.strokeWidth = stroke > 0.01 ? stroke : 0.01;\n    super._renderStroke(ctx);\n    this.setCoords();\n  }\n}\n\nexport const line = (points, options) => new Line(points, options);\n\nexport default Line;\n","import { Layer } from './Layer';\nimport { Line } from './vector/Line';\n\nexport class Connector extends Layer {\n  constructor(start, end, options) {\n    options = options || {};\n    options.zIndex = options.zIndex || 10;\n    options.class = 'connector';\n    super(options);\n\n    if (!start || !end) {\n      console.error('start or end is missing');\n      return;\n    }\n    this.start = start;\n    this.end = end;\n    this.strokeWidth = this.strokeWidth || 1;\n\n    Object.assign(this.style, {\n      strokeWidth: this.strokeWidth,\n      stroke: this.color || 'grey',\n      fill: this.fill || false,\n      selectable: false\n    });\n\n    this.draw();\n\n    this.registerListeners();\n  }\n\n  registerListeners() {\n    const vm = this;\n    this.start.on('update:links', () => {\n      vm.shape.set({\n        x1: vm.start.position.x,\n        y1: vm.start.position.y\n      });\n    });\n\n    this.end.on('update:links', () => {\n      vm.shape.set({\n        x2: vm.end.position.x,\n        y2: vm.end.position.y\n      });\n    });\n  }\n\n  draw() {\n    this.shape = new Line(\n      [this.start.position.x, this.start.position.y, this.end.position.x, this.end.position.y],\n      this.style\n    );\n    // this.shape.setCoords();\n  }\n\n  redraw() {\n    this.shape.set({\n      x1: this.start.position.x,\n      y1: this.start.position.y,\n      x2: this.end.position.x,\n      y2: this.end.position.y\n    });\n  }\n\n  setStart(start) {\n    this.start = start;\n    this.redraw();\n  }\n\n  setEnd(end) {\n    this.end = end;\n    this.redraw();\n  }\n\n  setColor(color) {\n    this.color = color;\n    this.style.stroke = color;\n    this.shape.set('stroke', color);\n    if (this.shape.canvas) {\n      this.shape.canvas.renderAll();\n    }\n  }\n\n  setStrokeWidth(strokeWidth) {\n    this.strokeWidth = strokeWidth;\n    this.style.strokeWidth = strokeWidth;\n    this.shape.set('strokeWidth', strokeWidth);\n    if (this.shape.canvas) {\n      this.shape.canvas.renderAll();\n    }\n  }\n}\n\nexport const connector = (start, end, options) => new Connector(start, end, options);\n\nexport default Connector;\n","import { Layer } from '../Layer';\nimport { Group } from '../Group';\nimport { Point } from '../../geometry/Point';\nimport { Connector } from '../Connector';\n\nexport class Marker extends Layer {\n  constructor(position, options) {\n    options = options || {};\n    options.zIndex = options.zIndex || 100;\n    options.keepOnZoom = options.keepOnZoom === undefined ? true : options.keepOnZoom;\n    options.position = new Point(position);\n    options.rotation = options.rotation || 0;\n    options.yaw = options.yaw || 0;\n    options.clickable = options.clickable !== undefined ? options.clickable : true;\n    options.class = 'marker';\n    super(options);\n\n    const vm = this;\n\n    this.text = this.text || '';\n    this.size = this.size || 10;\n    this.textColor = this.textColor || 'black';\n    this.fill = this.fill || 'white';\n    this.stroke = this.stroke || 'red';\n\n    Object.assign(this.style, {\n      left: this.position.x,\n      top: this.position.y,\n      // selectionBackgroundColor: false,\n      angle: this.rotation,\n      yaw: this.yaw,\n      clickable: this.clickable\n    });\n\n    if (this.text) {\n      this.textObj = new fabric.Text(this.text, {\n        fontSize: this.size,\n        fill: this.textColor\n      });\n    }\n\n    if (this.icon) {\n      fabric.Image.fromURL(\n        this.icon.url,\n        image => {\n          vm.image = image.scaleToWidth(this.size);\n          this.init();\n          // vm.shape.removeWithUpdate();\n        },\n        {\n          selectable: false,\n          evented: this.evented,\n          clickable: this.clickable,\n          opacity: this.opacity\n        }\n      );\n    } else {\n      this.circle = new fabric.Circle({\n        radius: this.size,\n        strokeWidth: 2,\n        stroke: this.stroke,\n        fill: this.fill\n      });\n      this.init();\n    }\n  }\n\n  init() {\n    const objects = [];\n    if (this.image) {\n      objects.push(this.image);\n    }\n    if (this.circle) {\n      objects.push(this.circle);\n    }\n    if (this.textObj) {\n      objects.push(this.textObj);\n    }\n    this.shape = new Group(objects, this.style);\n    this.links = this.links || [];\n    this.addLinks();\n    this.registerListeners();\n\n    process.nextTick(() => {\n      this.emit('ready');\n    });\n  }\n\n  registerListeners() {\n    const vm = this;\n    this.shape.on('moving', () => {\n      vm.onShapeDrag();\n    });\n    this.shape.on('rotating', () => {\n      vm.emit('rotating');\n    });\n\n    this.shape.on('mousedown', e => {\n      vm.onShapeMouseDown(e);\n    });\n    this.shape.on('mousemove', e => {\n      vm.onShapeMouseMove(e);\n    });\n    this.shape.on('mouseup', e => {\n      vm.onShapeMouseUp(e);\n    });\n    this.shape.on('mouseover', () => {\n      vm.emit('mouseover', vm);\n    });\n    this.shape.on('mouseout', () => {\n      vm.emit('mouseout', vm);\n    });\n  }\n\n  setPosition(position) {\n    this.position = new Point(position);\n    if (!this.shape) return;\n\n    this.shape.set({\n      left: this.position.x,\n      top: this.position.y\n    });\n\n    this.emit('update:links');\n\n    if (this.shape.canvas) {\n      this.shape.canvas.renderAll();\n    }\n  }\n\n  setRotation(rotation) {\n    this.rotation = rotation;\n\n    if (!this.shape) return;\n\n    this.shape.set({\n      angle: this.rotation\n    });\n\n    if (this.shape.canvas) {\n      this.shape.canvas.renderAll();\n    }\n  }\n\n  setOptions(options) {\n    if (!this.shape) return;\n\n    Object.keys(options).forEach(key => {\n      switch (key) {\n        case 'textColor':\n          this.setTextColor(options[key]);\n          break;\n        case 'stroke':\n          this.setStroke(options[key]);\n          break;\n        case 'fill':\n          this.setColor(options[key]);\n          break;\n\n        default:\n          break;\n      }\n    });\n    if (this.shape.canvas) {\n      this.shape.canvas.renderAll();\n    }\n  }\n\n  setTextColor(color) {\n    if (this.text && this.textObj) {\n      this.textObj.setColor(color);\n      this.textObj.canvas.renderAll();\n    }\n  }\n\n  setText(text) {\n    if (this.text && this.textObj) {\n      this.textObj.set({ text });\n      this.textObj.canvas.renderAll();\n    }\n  }\n\n  setStroke(color) {\n    if (this.circle) {\n      this.circle.set('stroke', color);\n    }\n  }\n\n  setColor(color) {\n    if (this.circle) {\n      this.circle.setColor(color);\n    }\n  }\n\n  setLinks(links) {\n    this.links = links;\n    this.addLinks();\n  }\n\n  setId(id) {\n    this.id = id;\n    if (this.shape.canvas) {\n      this.shape.set('id', id);\n    }\n  }\n\n  setSize(size) {\n    if (this.image) {\n      this.image.scaleToWidth(size);\n      if (this.image.canvas) {\n        this.image.canvas.renderAll();\n      }\n    } else if (this.circle) {\n      this.circle.setRadius(size);\n    }\n  }\n\n  addLinks() {\n    this.connectors = [];\n    this.links.forEach(link => {\n      const connector = new Connector(this, link);\n      this.connectors.push(connector);\n    });\n\n    this.addConnectors();\n  }\n\n  addConnectors() {\n    const vm = this;\n    this.connectors.forEach(connector => {\n      vm._map.addLayer(connector);\n    });\n  }\n\n  onAdded() {\n    this.addConnectors();\n  }\n\n  onShapeDrag() {\n    const matrix = this.shape.calcTransformMatrix();\n    const [, , , , x, y] = matrix;\n    this.position = new Point(x, y);\n    this.emit('update:links');\n    this.emit('moving');\n  }\n\n  onShapeMouseDown(e) {\n    this.dragStart = e;\n  }\n\n  onShapeMouseMove(e) {\n    if (this.dragStart) {\n      this.emit('dragstart');\n\n      const a = new fabric.Point(e.pointer.x, e.pointer.y);\n      const b = new fabric.Point(this.dragStart.pointer.x, this.dragStart.pointer.y);\n      // if distance is far enough, we don't want to fire click event\n      if (a.distanceFrom(b) > 3) {\n        this.dragStart = null;\n        this.dragging = true;\n      } else {\n        // this.dragging = false;\n      }\n    }\n\n    if (this.dragging) {\n      this.emit('drag');\n    } else {\n      this.emit('hover');\n    }\n  }\n\n  onShapeMouseUp() {\n    if (!this.dragging) {\n      this.emit('click');\n    } else {\n      this.emit('moved');\n    }\n    this.dragStart = null;\n    this.dragging = false;\n  }\n}\n\nexport const marker = (position, options) => new Marker(position, options);\n","import { ICON } from '../../core/Constants';\n\nexport class Icon extends fabric.Image {\n  constructor(options) {\n    super(options);\n    this.defaults = Object.assign({}, ICON);\n    Object.assign({}, this.defaults);\n    Object.assign({}, this._options);\n  }\n}\nexport const icon = (options) => new Icon(options);\n","import { Layer } from '../Layer';\nimport { Point } from '../../geometry/Point';\nimport { Group } from '../Group';\n\nexport class Polyline extends Layer {\n  constructor(_points, options) {\n    options = options || {};\n    options.points = _points || [];\n    super(options);\n    this.lines = [];\n    this.class = 'polyline';\n    this.strokeWidth = 1;\n\n    this.lineOptions = {\n      strokeWidth: this.strokeWidth,\n      stroke: this.color || 'grey',\n      fill: this.fill || false\n    };\n\n    this.shape = new Group([], {\n      selectable: false,\n      hasControls: false,\n      class: this.class,\n      parent: this\n    });\n\n    this.setPoints(this._points);\n  }\n\n  addPoint(point) {\n    this.points.push(new Point(point));\n\n    if (this.points.length > 1) {\n      const i = this.points.length - 1;\n      const j = this.points.length - 2;\n      const p1 = this.points[i];\n      const p2 = this.points[j];\n      const line = new fabric.Line(p1.getArray().concat(p2.getArray()), this.lineOptions);\n      this.lines.push(line);\n      this.shape.addWithUpdate(line);\n    }\n  }\n\n  setStrokeWidth(strokeWidth) {\n    this.lines.forEach(line => {\n      line.setStrokeWidth(strokeWidth);\n    });\n  }\n\n  setPoints(points = []) {\n    this.removeLines();\n    this.points = [];\n    for (let i = 0; i < points.length; i += 1) {\n      const point = new Point(points[i]);\n      this.points.push(point);\n      this.addPoint();\n    }\n  }\n\n  removeLines() {\n    for (let i = 0; i < this.lines.length; i += 1) {\n      this.shape.remove(this.lines[i]);\n    }\n    this.lines = [];\n  }\n}\n\nexport const polyline = (points, options) => new Polyline(points, options);\n","export class Circle extends fabric.Circle {}\n\nexport const circle = options => new Circle(options);\n","export class Rect extends fabric.Rect {\n  constructor(points, options) {\n    options = options || {};\n    options.strokeWidth = options.strokeWidth || 1;\n    options.class = 'rect';\n    super(points, options);\n    this._strokeWidth = options.strokeWidth;\n  }\n\n  _renderStroke(ctx) {\n    this.strokeWidth = this._strokeWidth / this.canvas.getZoom();\n    super._renderStroke(ctx);\n  }\n}\n\nexport const rect = (points, options) => new Rect(points, options);\n\nexport default Rect;\n","import { Rect } from '../vector/index';\nimport { Layer } from '../Layer';\n\nexport class MarkerGroup extends Layer {\n  constructor(bounds, options) {\n    options = options || {};\n    options.bounds = bounds;\n    options.zIndex = options.zIndex || 50;\n    options.class = 'markergroup';\n    super(options);\n    if (!this.bounds) {\n      console.error('bounds is missing!');\n      return;\n    }\n    this.style = {\n      strokeWidth: 1,\n      stroke: this.stroke || 'black',\n      fill: this.color || '#88888822',\n      class: this.class,\n      zIndex: this.zIndex,\n      parent: this\n    };\n    this.draw();\n  }\n\n  setBounds(bounds) {\n    this.bounds = bounds;\n    this.draw();\n  }\n\n  draw() {\n    const width = this.bounds[1][0] - this.bounds[0][0];\n    const height = this.bounds[1][1] - this.bounds[0][1];\n    this.coords = {\n      left: this.bounds[0][0] + width / 2,\n      top: this.bounds[0][1] + height / 2,\n      width,\n      height\n    };\n\n    if (this.shape) {\n      this.shape.set(this.coords);\n    } else {\n      Object.assign(this.style, this.coords);\n      this.shape = new Rect(this.style);\n    }\n  }\n}\nexport const markerGroup = (bounds, options) => new MarkerGroup(bounds, options);\nexport default MarkerGroup;\n","class ArrowHead extends fabric.Triangle {\n  constructor(points, options) {\n    options = options || {};\n    options.headLength = options.headLength || 10;\n    options.stroke = options.stroke || '#207cca';\n\n    const [x1, y1, x2, y2] = points;\n    const dx = x2 - x1;\n    const dy = y2 - y1;\n    let angle = Math.atan2(dy, dx);\n\n    angle *= 180 / Math.PI;\n    angle += 90;\n\n    if (options.lastAngle !== undefined) {\n      angle = options.lastAngle;\n      console.log(`Angle: ${angle}`);\n    }\n\n    super({\n      angle,\n      fill: options.stroke,\n      top: y2,\n      left: x2,\n      height: options.headLength,\n      width: options.headLength,\n      originX: 'center',\n      originY: 'center',\n      selectable: false\n    });\n  }\n}\nexport default ArrowHead;\n","import ArrowHead from './ArrowHead';\n\nexport class Arrow extends fabric.Group {\n  constructor(point, options) {\n    options = options || {};\n    options.strokeWidth = options.strokeWidth || 5;\n    options.stroke = options.stroke || '#7db9e8';\n    options.class = 'arrow';\n    super(\n      [],\n      Object.assign(options, {\n        evented: false\n      })\n    );\n    this.pointArray = [point, Object.assign({}, point)];\n    this.options = options;\n    this.draw();\n  }\n\n  draw() {\n    if (this.head) {\n      this.remove(this.head);\n    }\n\n    if (this.polyline) {\n      this.remove(this.polyline);\n    }\n\n    this.polyline = new fabric.Polyline(\n      this.pointArray,\n      Object.assign(this.options, {\n        strokeLineJoin: 'round',\n        fill: false\n      })\n    );\n\n    this.addWithUpdate(this.polyline);\n\n    const lastPoints = this.getLastPoints();\n\n    const p1 = new fabric.Point(lastPoints[0], lastPoints[1]);\n    const p2 = new fabric.Point(lastPoints[2], lastPoints[3]);\n    const dis = p1.distanceFrom(p2);\n    console.log(`dis = ${dis}`);\n\n    this.head = new ArrowHead(\n      lastPoints,\n      Object.assign(this.options, {\n        headLength: this.strokeWidth * 2,\n        lastAngle: dis <= 10 ? this.lastAngle : undefined\n      })\n    );\n\n    if (dis > 10) {\n      this.lastAngle = this.head.angle;\n    }\n    this.addWithUpdate(this.head);\n  }\n\n  addPoint(point) {\n    this.pointArray.push(point);\n    this.draw();\n  }\n\n  addTempPoint(point) {\n    const len = this.pointArray.length;\n    const lastPoint = this.pointArray[len - 1];\n    lastPoint.x = point.x;\n    lastPoint.y = point.y;\n    this.draw();\n  }\n\n  getLastPoints() {\n    const len = this.pointArray.length;\n    const point1 = this.pointArray[len - 2];\n    const point2 = this.pointArray[len - 1];\n    return [point1.x, point1.y, point2.x, point2.y];\n  }\n\n  setColor(color) {\n    this._objects.forEach(obj => {\n      obj.setColor(color);\n    });\n  }\n}\n\nexport const arrow = (points, options) => new Arrow(points, options);\n\nexport default Arrow;\n","/* eslint-disable no-unused-vars */\nimport Base from '../core/Base';\nimport { Arrow } from './Arrow';\n\nconst Modes = {\n  SELECT: 'select',\n  DRAWING: 'drawing',\n  ARROW: 'arrow',\n  TEXT: 'text'\n};\n\nexport class Canvas extends Base {\n  constructor(container, options) {\n    super(options);\n\n    this.container = container;\n\n    const canvas = document.createElement('canvas');\n    this.container.appendChild(canvas);\n    canvas.setAttribute('id', 'indoorjs-canvas');\n\n    canvas.width = this.width || this.container.clientWidth;\n    canvas.height = this.height || this.container.clientHeight;\n\n    this.currentColor = this.currentColor || 'black';\n    this.fontFamily = this.fontFamily || 'Roboto';\n\n    this.canvas = new fabric.Canvas(canvas, {\n      freeDrawingCursor: 'none',\n      freeDrawingLineWidth: this.lineWidth\n    });\n    this.arrows = [];\n\n    this.setLineWidth(this.lineWidth || 10);\n    this.addCursor();\n    this.addListeners();\n\n    this.setModeAsArrow();\n  }\n\n  setModeAsDrawing() {\n    this.mode = Modes.DRAWING;\n    this.canvas.isDrawingMode = true;\n    this.canvas.selection = false;\n    this.onModeChanged();\n  }\n\n  isDrawingMode() {\n    return this.mode === Modes.DRAWING;\n  }\n\n  setModeAsSelect() {\n    this.mode = Modes.SELECT;\n    this.canvas.isDrawingMode = false;\n    this.canvas.selection = true;\n    this.onModeChanged();\n  }\n\n  isSelectMode() {\n    return this.mode === Modes.SELECT;\n  }\n\n  setModeAsArrow() {\n    this.mode = Modes.ARROW;\n    this.canvas.isDrawingMode = false;\n    this.canvas.selection = false;\n    this.onModeChanged();\n  }\n\n  isArrowMode() {\n    return this.mode === Modes.ARROW;\n  }\n\n  setModeAsText() {\n    this.mode = Modes.TEXT;\n    this.canvas.isDrawingMode = false;\n    this.canvas.selection = false;\n    this.onModeChanged();\n  }\n\n  isTextMode() {\n    return this.mode === Modes.TEXT;\n  }\n\n  onModeChanged() {\n    this.updateCursor();\n    this.emit('mode-changed', this.mode);\n    this.canvas._objects.forEach(obj => {\n      obj.evented = this.isSelectMode();\n    });\n  }\n\n  addListeners() {\n    const canvas = this.canvas;\n    canvas.on('mouse:move', evt => {\n      const mouse = canvas.getPointer(evt.e);\n      if (this.mousecursor) {\n        this.mousecursor\n          .set({\n            top: mouse.y,\n            left: mouse.x\n          })\n          .setCoords()\n          .canvas.renderAll();\n      }\n\n      if (this.isTextMode()) {\n        console.log('text');\n      } else if (this.isArrowMode()) {\n        if (this.activeArrow) {\n          this.activeArrow.addTempPoint(mouse);\n        }\n        this.canvas.requestRenderAll();\n      }\n    });\n\n    canvas.on('mouse:out', () => {\n      // put circle off screen\n      if (!this.mousecursor) return;\n      this.mousecursor\n        .set({\n          left: -1000,\n          top: -1000\n        })\n        .setCoords();\n\n      this.cursor.renderAll();\n    });\n\n    canvas.on('mouse:up', event => {\n      if (canvas.mouseDown) {\n        canvas.fire('mouse:click', event);\n      }\n      canvas.mouseDown = false;\n    });\n\n    canvas.on('mouse:move', event => {\n      canvas.mouseDown = false;\n    });\n\n    canvas.on('mouse:down', event => {\n      canvas.mouseDown = true;\n    });\n\n    canvas.on('mouse:click', event => {\n      console.log('mouse click', event);\n      const mouse = canvas.getPointer(event.e);\n      if (event.target) return;\n      if (this.isTextMode()) {\n        const text = new fabric.IText('Text', {\n          left: mouse.x,\n          top: mouse.y,\n          width: 100,\n          fontSize: 20,\n          fontFamily: this.fontFamily,\n          lockUniScaling: true,\n          fill: this.currentColor,\n          stroke: this.currentColor\n        });\n        canvas\n          .add(text)\n          .setActiveObject(text)\n          .renderAll();\n\n        this.setModeAsSelect();\n      } else if (this.isArrowMode()) {\n        console.log('arrow mode');\n        if (this.activeArrow) {\n          this.activeArrow.addPoint(mouse);\n        } else {\n          this.activeArrow = new Arrow(mouse, {\n            stroke: this.currentColor,\n            strokeWidth: this.lineWidth\n          });\n          this.canvas.add(this.activeArrow);\n        }\n        this.canvas.requestRenderAll();\n      }\n    });\n\n    canvas.on('mouse:dblclick', event => {\n      console.log('mouse:dbclick');\n      if (this.isArrowMode() && this.activeArrow) {\n        this.arrows.push(this.activeArrow);\n        this.activeArrow = null;\n      }\n    });\n\n    canvas.on('selection:created', event => {\n      this.emit('selected');\n    });\n\n    canvas.on('selection:cleared', event => {\n      this.emit('unselected');\n    });\n  }\n\n  removeSelected() {\n    this.canvas.remove(this.canvas.getActiveObject());\n    this.canvas.getActiveObjects().forEach(obj => {\n      this.canvas.remove(obj);\n    });\n    this.canvas.discardActiveObject().renderAll();\n  }\n\n  updateCursor() {\n    if (!this.cursor) return;\n\n    const canvas = this.canvas;\n\n    if (this.mousecursor) {\n      this.cursor.remove(this.mousecursor);\n      this.mousecursor = null;\n    }\n\n    const cursorOpacity = 0.3;\n    let mousecursor = null;\n    if (this.isDrawingMode()) {\n      mousecursor = new fabric.Circle({\n        left: -1000,\n        top: -1000,\n        radius: canvas.freeDrawingBrush.width / 2,\n        fill: `rgba(255,0,0,${cursorOpacity})`,\n        stroke: 'black',\n        originX: 'center',\n        originY: 'center'\n      });\n    } else if (this.isTextMode()) {\n      mousecursor = new fabric.Path('M0,-10 V10', {\n        left: -1000,\n        top: -1000,\n        radius: canvas.freeDrawingBrush.width / 2,\n        fill: `rgba(255,0,0,${cursorOpacity})`,\n        stroke: `rgba(0,0,0,${cursorOpacity})`,\n        originX: 'center',\n        originY: 'center',\n        scaleX: 1,\n        scaleY: 1\n      });\n    } else {\n      mousecursor = new fabric.Path('M0,-10 V10 M-10,0 H10', {\n        left: -1000,\n        top: -1000,\n        radius: canvas.freeDrawingBrush.width / 2,\n        fill: `rgba(255,0,0,${cursorOpacity})`,\n        stroke: `rgba(0,0,0,${cursorOpacity})`,\n        originX: 'center',\n        originY: 'center'\n      });\n    }\n\n    if (this.isSelectMode()) {\n      mousecursor = null;\n      this.canvas.defaultCursor = 'default';\n    } else {\n      this.canvas.defaultCursor = 'none';\n    }\n    if (mousecursor) {\n      this.cursor.add(mousecursor);\n    }\n    this.mousecursor = mousecursor;\n  }\n\n  addCursor() {\n    const canvas = this.canvas;\n    const cursorCanvas = document.createElement('canvas');\n    this.canvas.wrapperEl.appendChild(cursorCanvas);\n    cursorCanvas.setAttribute('id', 'indoorjs-cursor-canvas');\n    cursorCanvas.style.position = 'absolute';\n    cursorCanvas.style.top = '0';\n    cursorCanvas.style.pointerEvents = 'none';\n    cursorCanvas.width = this.width || this.container.clientWidth;\n    cursorCanvas.height = this.height || this.container.clientHeight;\n    this.cursorCanvas = cursorCanvas;\n    canvas.defaultCursor = 'none';\n    this.cursor = new fabric.StaticCanvas(cursorCanvas);\n    this.updateCursor();\n  }\n\n  setColor(color) {\n    this.currentColor = color;\n    this.canvas.freeDrawingBrush.color = color;\n\n    const obj = this.canvas.getActiveObject();\n    if (obj) {\n      obj.set('stroke', color);\n      obj.set('fill', color);\n      this.canvas.requestRenderAll();\n    }\n\n    if (!this.mousecursor) return;\n\n    this.mousecursor\n      .set({\n        left: 100,\n        top: 100,\n        fill: color\n      })\n      .setCoords()\n      .canvas.renderAll();\n  }\n\n  setLineWidth(width) {\n    this.lineWidth = width;\n    this.canvas.freeDrawingBrush.width = width;\n\n    if (!this.mousecursor) return;\n\n    this.mousecursor\n      .set({\n        left: 100,\n        top: 100,\n        radius: width / 2\n      })\n      .setCoords()\n      .canvas.renderAll();\n  }\n\n  setFontFamily(family) {\n    this.fontFamily = family;\n    const obj = this.canvas.getActiveObject();\n    if (obj && obj.type === 'i-text') {\n      obj.set('fontFamily', family);\n      this.canvas.requestRenderAll();\n    }\n  }\n\n  clear() {\n    this.arrows = [];\n    this.canvas.clear();\n  }\n}\n\nexport const canvas = (container, options) => new Canvas(container, options);\n","import fabric from 'fabric-pure-browser';\n\nimport { version } from '../package.json';\n\nconsole.log('fabricJS ', fabric.version || window.fabric.version);\nconsole.log('IndoorJS ', version);\n\nexport { version };\n\n// constants\nexport * from './core/index';\n\n// geometry\nexport * from './geometry/index';\n\n// map\nexport * from './map/index';\n\n// floorplan\nexport * from './floorplan/index';\n\n// layer\nexport * from './layer/index';\n\n// Free Drawing Canvas\nexport * from './paint/index';\n"],"names":["Point","x","y","params","length","Object","prototype","hasOwnProperty","call","console","error","point","fabric","Modes","SELECT","GRAB","MEASURE","DRAW","MAP","center","zoom","minZoom","maxZoom","gridEnabled","zoomEnabled","selectEnabled","mode","showGrid","MARKER","position","ICON","url","size","anchor","originX","originY","lockUniScaling","lockScalingFlip","transparentCorners","centeredScaling","cornerColor","borderColor","borderOpacity","cornerOpacity","cornerStrokeColor","objectCaching","Group","selectionBackgroundColor","borderDashArray","padding","getBounds","coords","push","left","width","top","height","global","isNum","val","isNaN","ev","toElement","currentTarget","toElementBoundingRect","getBoundingClientRect","orgEv","originalEvent","hasTouches","touches","pageX","pageY","clientX","clientY","currentPoint","isRight","which","button","stopThresholdDefault","bounceDeceleration","bounceAcceleration","window","addEventListener","Impetus","source","sourceEl","document","updateCallback","update","stopCallback","stop","multiplier","friction","initialValues","boundX","boundY","bounce","boundXmin","boundXmax","boundYmin","boundYmax","pointerLastX","pointerLastY","pointerCurrentX","pointerCurrentY","pointerId","decVelX","decVelY","targetX","targetY","stopThreshold","ticking","pointerActive","paused","decelerating","trackingPoints","init","querySelector","Error","callUpdateCallback","onDown","destroy","removeEventListener","cleanUpRuntimeEvents","pause","resume","setValues","setMultiplier","setBoundX","setBoundY","onMove","getPassiveSupported","passive","onUp","stopTracking","addRuntimeEvents","normalizeEvent","type","touch","targetTouches","changedTouches","id","identifier","event","addTrackingPoint","preventDefault","requestTick","startDecelAnim","time","Date","now","shift","updateAndRender","pointerChangeX","pointerChangeY","diff","checkBounds","dragOutOfBoundsMultiplier","Math","pow","requestAnimFrame","restrict","xDiff","yDiff","undefined","inBounds","firstPoint","lastPoint","xOffset","yOffset","timeOffset","D","abs","stepDecelAnim","reboundAdjust","adjust","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setTimeout","passiveSupported","options","defineProperty","get","err","rootPosition","mouseEventOffset","target","out","srcElement","Array","isArray","cx","cy","rect","getBoundingClientOffset","element","body","distance","a","b","sqrt","touchPinch","emitter","EventEmitter2","fingers","activeCount","lastDistance","ended","enabled","defineProperties","pinching","enable","disable","indexOfTouch","i","onTouchStart","onTouchMove","onTouchRemoved","newTouch","idx","first","newIndex","oldIndex","newFinger","Finger","eventOffset","oldTouch","emit","initialDistance","computeDistance","changed","movedTouch","currentDistance","removed","otherIdx","otherTouch","getPrefixed","name","lastTime","timeoutDefer","fn","timeToCall","max","bind","obj","slice","apply","arguments","args","concat","requestFn","cancelFn","cancelAnimationFrame","clearTimeout","raf","context","immediate","cancel","MagicScroll","speed","smooth","current","scrollingElement","documentElement","parentNode","moving","scrollTop","pos","frame","scrolled","scope","e","delta","normalizeWheelDelta","detail","wheelDelta","onUpdate","requestFrame","oRequestAnimationFrame","msRequestAnimationFrame","func","panzoom","cb","Function","cursor","hasPassive","supported","opts","impetus","magicScroll","initX","initY","initFn","onMouseMove","evPos","wheelListener","lastY","lastX","dx","dy","dz","x0","y0","schedule","pinch","mult","initialCoords","on","curr","f1","f2","prev","planned","frameId","arg","unpanzoom","clamp","min","len","almostEqual","absoluteError","relativeError","d","DBL_EPSILON","FLT_EPSILON","range","start","step","toReturn","increasing","log10","log","isMultiple","eps","remainder","almost","minStep","srcSteps","power","floor","lg","order","steps","map","v","str","String","num","parseFloat","match","PIXELS_PER_INCH","defaults","toPX","parts","parseUnit","px","value","toString","getPrototypeOf","Base","_options","assign","alpha","color","replace","split","join","gridStyle","unit","lines","state","coord","coordinate","scale","offset","ceil","lineColor","light","heavy","tenStep","nextStep","colors","ticks","tickWidth","axisWidth","labels","orientation","Number","toFixed","format","Axis","values","t","getRatio","getRange","Grid","canvas","getContext","setDefaults","draw","shape","pt","pr","pb","pl","axisCoords","opposite","getCoords","axisOrigin","setWidth","setHeight","calcCoordinate","axisX","axisY","grid","MAX_VALUE","axisColor","lineWidth","tickAlign","labelColor","fill","fontSize","units","toPx","fontFamily","lineColors","tick","isObj","keys","forEach","label","pixelRatio","devicePixelRatio","autostart","interactions","Infinity","origin","panEnabled","style","axis","clearRect","drawLines","ctx","axisRatio","j","strokeStyle","beginPath","x1","y1","x2","y2","moveTo","lineTo","stroke","closePath","normals","xDif","yDif","dist","tickCoords","labelCoords","k","drawLabels","font","fillStyle","textBaseline","textHeight","indent","textOffset","isOpp","disabled","textWidth","measureText","textLeft","textTop","fillText","ModesMixin","superclass","isDrawingMode","interactive","selection","hoverCursor","moveCursor","discardActiveObject","freeDrawingBrush","setMode","Measurer","hasBorders","selectable","hasControls","end","completed","objects","object","remove","clear","add","multiply","line","Line","evented","strokeDashArray","lineEndOptions","strokeWidth","radius","lineEndOptions2","circle1","Circle","circle2","circle11","circle22","text","round","distanceFrom","Text","textBackgroundColor","registerListeners","setEnd","pointer","setStart","Measurement","measurer","absolutePointer","requestRenderAll","complete","mix","MixinBuilder","mixins","reduce","c","m","Map","container","createElement","appendChild","setAttribute","clientWidth","clientHeight","Canvas","preserveObjectStacking","renderOnAddRemove","absolutePan","addFloorPlan","addGrid","vm","measurement","floorplan","img","addLayer","layer","_objects","sort","o1","o2","zIndex","keepOnZoom","set","setCoords","calculateMaxZoom","gridCanvas","cloneCanvas","index","clone","wrapperEl","process","minX","maxX","minY","maxY","forEachObject","right","bottom","objectId","group","getObjects","find","item","getTransformPosition","util","transformPoint","viewportTransform","getPointer","ignoreZoom","scroll","getElementOffset","upperCanvasEl","bounds","boundsWidth","boundsHeight","cssScale","calcOffset","_offset","restorePointerVpt","retinaScaling","getRetinaScaling","oldWidth","oldHeight","setSize","relativePan","boundingBox","getBoundingBox","boundWidth","boundHeight","scaleX","scaleY","setZoom","boundsPadding","getPointerLength","boundingBoxWidth","boundingBoxHeight","topLeft","bottomRight","limited","update2","render","zoomToPoint","isGrabMode","setCursor","lastUpdatedTime","hasKeepZoom","prevZoom","curZoom","oX","oY","tx","ty","setX","setY","view","copy","renderAll","parent","removeWithUpdate","orgYaw","yaw","fire","angle","_set","deselected","inGroup","selected","dragObject","mouseMove","isMeasureMode","clickable","dragging","onClick","modeToggleByKey","onResize","off","list","getCenterPoint","Layer","draggable","opacity","lockMovementX","lockMovementY","key","_map","removeLayer","Floor","load","lastIndexOf","ext","substr","loadSVGFromURL","filter","image","groupSVGElements","setImage","Image","fromURL","handler","Rect","ratio","originalWidth","originalHeight","scaleToWidth","drawShape","addWithUpdate","points","_strokeWidth","getZoom","Connector","redraw","connector","Marker","rotation","textColor","textObj","icon","circle","links","addLinks","onShapeDrag","onShapeMouseDown","onShapeMouseMove","onShapeMouseUp","setTextColor","setStroke","setColor","setRadius","connectors","link","addConnectors","matrix","calcTransformMatrix","dragStart","marker","Icon","Polyline","_points","lineOptions","setPoints","p1","p2","getArray","setStrokeWidth","removeLines","addPoint","polyline","MarkerGroup","markerGroup","ArrowHead","headLength","atan2","PI","lastAngle","Triangle","Arrow","pointArray","head","strokeLineJoin","lastPoints","getLastPoints","dis","point1","point2","DRAWING","ARROW","TEXT","currentColor","freeDrawingCursor","freeDrawingLineWidth","arrows","setLineWidth","addCursor","addListeners","setModeAsArrow","onModeChanged","updateCursor","isSelectMode","evt","mouse","mousecursor","isTextMode","isArrowMode","activeArrow","addTempPoint","mouseDown","IText","setActiveObject","setModeAsSelect","getActiveObject","getActiveObjects","cursorOpacity","Path","defaultCursor","cursorCanvas","pointerEvents","StaticCanvas","family","version"],"mappings":"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"}